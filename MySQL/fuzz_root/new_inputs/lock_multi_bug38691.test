  if (!$BIG_TEST)  {      }   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   connect (locker,localhost,root,,);
connect (writer,localhost,root,,);
DROP TABLE IF EXISTS t1,t2,t3;
CREATE TABLE t1 (  a int(11) unsigned default NULL,  b varchar(255) default NULL,  UNIQUE KEY a (a),  KEY b (b));
INSERT INTO t1 VALUES (1, 1), (2, 2), (3, 3);
CREATE TABLE t2 SELECT * FROM t1;
CREATE TABLE t3 SELECT * FROM t1;
while ($i) {  send UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)         SET a = NULL WHERE t1.b <> t2.b;
  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)                     SET a = NULL WHERE t1.b <> t2.b';
while ($i) {  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  ALTER TABLE t2 DROP COLUMN a;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a) SET a = NULL WHERE t1.b <> t2.b';
  ALTER TABLE t2 DROP COLUMN a;
DROP TABLE t1, t2, t3;
  if (!$BIG_TEST)  {      }   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   connect (locker,localhost,root,,);
connect (writer,localhost,root,,);
DROP TABLE IF EXISTS t1,t2,t3;
CREATE TABLE t1 (  a int(11) unsigned default NULL,  b varchar(255) default NULL,  UNIQUE KEY a (a),  KEY b (b));
INSERT INTO t1 VALUES (1, 1), (2, 2), (3, 3);
CREATE TABLE t2 SELECT * FROM t1;
CREATE TABLE t3 SELECT * FROM t1;
while ($i) {  send UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)         SET a = NULL WHERE t1.b <> t2.b;
  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)                     SET a = NULL WHERE t1.b <> t2.b';
while ($i) {  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  ALTER TABLE t2 DROP COLUMN a;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a) SET a = NULL WHERE t1.b <> t2.b';
  ALTER TABLE t2 DROP COLUMN a;
DROP TABLE t1, t2, t3;
  if (!$BIG_TEST)  {      }   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   connect (locker,localhost,root,,);
connect (writer,localhost,root,,);
DROP TABLE IF EXISTS t1,t2,t3;
CREATE TABLE t1 (  a int(11) unsigned default NULL,  b varchar(255) default NULL,  UNIQUE KEY a (a),  KEY b (b));
INSERT INTO t1 VALUES (1, 1), (2, 2), (3, 3);
CREATE TABLE t2 SELECT * FROM t1;
CREATE TABLE t3 SELECT * FROM t1;
while ($i) {  send UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)         SET a = NULL WHERE t1.b <> t2.b;
  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)                     SET a = NULL WHERE t1.b <> t2.b';
while ($i) {  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  ALTER TABLE t2 DROP COLUMN a;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a) SET a = NULL WHERE t1.b <> t2.b';
  ALTER TABLE t2 DROP COLUMN a;
DROP TABLE t1, t2, t3;
  if (!$BIG_TEST)  {      }   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   connect (locker,localhost,root,,);
connect (writer,localhost,root,,);
DROP TABLE IF EXISTS t1,t2,t3;
CREATE TABLE t1 (  a int(11) unsigned default NULL,  b varchar(255) default NULL,  UNIQUE KEY a (a),  KEY b (b));
INSERT INTO t1 VALUES (1, 1), (2, 2), (3, 3);
CREATE TABLE t2 SELECT * FROM t1;
CREATE TABLE t3 SELECT * FROM t1;
while ($i) {  send UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)         SET a = NULL WHERE t1.b <> t2.b;
  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)                     SET a = NULL WHERE t1.b <> t2.b';
while ($i) {  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  ALTER TABLE t2 DROP COLUMN a;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a) SET a = NULL WHERE t1.b <> t2.b';
  ALTER TABLE t2 DROP COLUMN a;
DROP TABLE t1, t2, t3;
  if (!$BIG_TEST)  {      }   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   connect (locker,localhost,root,,);
connect (writer,localhost,root,,);
DROP TABLE IF EXISTS t1,t2,t3;
CREATE TABLE t1 (  a int(11) unsigned default NULL,  b varchar(255) default NULL,  UNIQUE KEY a (a),  KEY b (b));
INSERT INTO t1 VALUES (1, 1), (2, 2), (3, 3);
CREATE TABLE t2 SELECT * FROM t1;
CREATE TABLE t3 SELECT * FROM t1;
while ($i) {  send UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)         SET a = NULL WHERE t1.b <> t2.b;
  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a)                     SET a = NULL WHERE t1.b <> t2.b';
while ($i) {  ALTER TABLE t2 ADD COLUMN (c INT);
  ALTER TABLE t2 DROP COLUMN c;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  ALTER TABLE t2 DROP COLUMN a;
while ($i) {  dec $i;
  ALTER TABLE t2 ADD COLUMN a int(11) unsigned default NULL;
  UPDATE t2 SET a=b;
  PREPARE stmt FROM 'UPDATE t2 INNER JOIN (t1 JOIN t3 USING(a)) USING(a) SET a = NULL WHERE t1.b <> t2.b';
  ALTER TABLE t2 DROP COLUMN a;
DROP TABLE t1, t2, t3;
