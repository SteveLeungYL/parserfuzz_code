connection default;
CREATE USER unlocked_user@localhost IDENTIFIED BY 'pas';
SELECT account_locked FROM mysql.user  WHERE user='unlocked_user' and host = 'localhost';
SELECT CURRENT_USER();
connection default;
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
disconnect unlocked_user_con;
SELECT CURRENT_USER();
connection default;
FLUSH PRIVILEGES;
connection unlocked_user_con;
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
UPDATE mysql.user SET account_locked='y'  WHERE user='unlocked_user' and host = 'localhost';
FLUSH PRIVILEGES;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT UNLOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
connection default;
CREATE USER unlocked_user2@localhost IDENTIFIED BY 'pas';
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost,           unlocked_user2@localhost ACCOUNT UNLOCK;
SELECT user, account_locked FROM mysql.user  WHERE (user = 'unlocked_user' and host = 'localhost') or        (user = 'unlocked_user2' and host = 'localhost') ORDER BY user;
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
SHOW CREATE USER unlocked_user@localhost;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SHOW CREATE USER unlocked_user@localhost;
connection default;
DROP USER unlocked_user@localhost;
DROP USER unlocked_user2@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER ''@localhost ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost PASSWORD EXPIRE ACCOUNT LOCK;
DROP USER ''@localhost;
connection default;
CREATE user ''@localhost IDENTIFIED BY 'pass';
CREATE USER 'unlocked_user'@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
connection anonymous_user_con;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
disconnect anonymous_user_con;
connection default;
DROP USER unlocked_user@localhost;
DROP USER ''@localhost;
connection default;
CREATE USER u1@localhost IDENTIFIED BY 'pass';
CREATE USER u2@localhost IDENTIFIED BY 'pass';
GRANT ALL ON *.* TO u1@localhost;
DELIMITER |;
CREATE TABLE mysql.t1(counter INT)|INSERT INTO mysql.t1 VALUES(0)|CREATE DEFINER = u1@localhost PROCEDURE mysql.p1()BEGIN  UPDATE mysql.t1 SET counter = counter + 1;
  SELECT counter FROM mysql.t1;
END|DELIMITER ;|CALL mysql.p1();
GRANT EXECUTE ON PROCEDURE mysql.p1 TO u2@localhost;
ALTER USER u1@localhost ACCOUNT LOCK;
connect(u1_con,localhost,u1,pass);
connect(u2_con,localhost,u2,pass);
SELECT CURRENT_USER();
CALL mysql.p1();
disconnect u2_con;
connection default;
FLUSH STATUS;
CREATE USER 'u3'@'localhost' IDENTIFIED BY 'pass' ACCOUNT LOCK;
SHOW STATUS LIKE 'Locked_connects';
disable_query_log;
while ($1) {      connect(unlocked_user_con, localhost, u3, pass);
  connection default;
  ALTER USER u3@localhost ACCOUNT UNLOCK;
  connect(unlocked_user_con, localhost, u3, pass);
  disconnect unlocked_user_con;
  connection default;
  ALTER USER u3@localhost ACCOUNT LOCK;
  dec $1;
enable_query_log;
connection default;
SHOW STATUS LIKE 'Locked_connects';
FLUSH STATUS;
connection default;
CREATE USER u1@localhost REQUIRE NONE ACCOUNT LOCK WITH MAX_QUERIES_PER_HOUR 100;
DROP USER u1@localhost;
CREATE USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 100 ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 99 ACCOUNT UNLOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 98 PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK WITH MAX_QUERIES_PER_HOUR 97 PASSWORD EXPIRE;
DROP USER u1@localhost;
CREATE USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT LOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE NEVER ACCOUNT LOCK PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
                         "Expected .*, found .*. "                         "The table is probably corrupted");
connection default;
CREATE TABLE mysql.temp_user LIKE mysql.user;
INSERT INTO mysql.temp_user SELECT * FROM mysql.user;
ALTER TABLE mysql.user DROP COLUMN account_locked;
ALTER TABLE mysql.user DROP COLUMN create_role_priv;
ALTER TABLE mysql.user DROP COLUMN drop_role_priv;
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass';
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
SELECT user, account_locked FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
connection default;
ALTER USER backuser@localhost ACCOUNT LOCK;
ALTER USER backuser@localhost ACCOUNT UNLOCK;
DROP USER backuser@localhost;
DROP TABLE mysql.user;
ALTER TABLE mysql.temp_user RENAME mysql.user;
FLUSH PRIVILEGES;
connection default;
CREATE DATABASE account;
CREATE TABLE account.`account` (account text(20));
INSERT INTO `account`.account VALUES("account");
SELECT account FROM account.account WHERE account = 'account';
SET @account = "account_before";
delimiter |;
CREATE PROCEDURE account.account(OUT ac CHAR(20))BEGIN      if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
     SELECT account.`account`.account INTO ac FROM account.account;
END|delimiter ;|CALL account.account(@account);
SELECT @account;
DROP DATABASE account;
CREATE USER ACCOUNT@localhost ACCOUNT LOCK;
DROP USER ACCOUNT@localhost;
connection default;
DROP PROCEDURE mysql.p1;
DROP TABLE mysql.t1;
DROP USER u1@localhost;
DROP USER u2@localhost;
DROP USER u3@localhost;
CREATE USER u1 IDENTIFIED BY 'pass';
SHOW CREATE USER u1;
ALTER USER u1 ACCOUNT LOCK;
SHOW CREATE USER u1;
DROP USER u1;
TRUNCATE TABLE mysql.general_log;
SET @old_log_output=          @@global.log_output;
SET @old_general_log=         @@global.general_log;
SET @old_general_log_file=    @@global.general_log_file;
eval SET GLOBAL general_log_file = '$MYSQLTEST_VARDIR/log/rewrite_general.log';
SET GLOBAL log_output =       'FILE,TABLE';
SET GLOBAL general_log=       'ON';
CREATE USER u1 IDENTIFIED BY 'pass';
CREATE USER u2 IDENTIFIED BY 'pass' ACCOUNT LOCK;
CREATE USER u3 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u1 IDENTIFIED BY 'pass';
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u2 IDENTIFIED BY 'pass';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'CREATE USER %' AND                                             command_type NOT LIKE 'Prepare';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'ALTER USER %'AND                                             command_type NOT LIKE 'Prepare';
DROP USER u1, u2, u3;
SET GLOBAL general_log_file=  @old_general_log_file;
SET GLOBAL general_log=       @old_general_log;
SET GLOBAL log_output=        @old_log_output;
TRUNCATE TABLE mysql.general_log;
connection default;
CREATE USER unlocked_user@localhost IDENTIFIED BY 'pas';
SELECT account_locked FROM mysql.user  WHERE user='unlocked_user' and host = 'localhost';
SELECT CURRENT_USER();
connection default;
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
disconnect unlocked_user_con;
SELECT CURRENT_USER();
connection default;
FLUSH PRIVILEGES;
connection unlocked_user_con;
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
UPDATE mysql.user SET account_locked='y'  WHERE user='unlocked_user' and host = 'localhost';
FLUSH PRIVILEGES;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT UNLOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
connection default;
CREATE USER unlocked_user2@localhost IDENTIFIED BY 'pas';
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost,           unlocked_user2@localhost ACCOUNT UNLOCK;
SELECT user, account_locked FROM mysql.user  WHERE (user = 'unlocked_user' and host = 'localhost') or        (user = 'unlocked_user2' and host = 'localhost') ORDER BY user;
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
SHOW CREATE USER unlocked_user@localhost;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SHOW CREATE USER unlocked_user@localhost;
connection default;
DROP USER unlocked_user@localhost;
DROP USER unlocked_user2@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER ''@localhost ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost PASSWORD EXPIRE ACCOUNT LOCK;
DROP USER ''@localhost;
connection default;
CREATE user ''@localhost IDENTIFIED BY 'pass';
CREATE USER 'unlocked_user'@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
connection anonymous_user_con;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
disconnect anonymous_user_con;
connection default;
DROP USER unlocked_user@localhost;
DROP USER ''@localhost;
connection default;
CREATE USER u1@localhost IDENTIFIED BY 'pass';
CREATE USER u2@localhost IDENTIFIED BY 'pass';
GRANT ALL ON *.* TO u1@localhost;
DELIMITER |;
CREATE TABLE mysql.t1(counter INT)|INSERT INTO mysql.t1 VALUES(0)|CREATE DEFINER = u1@localhost PROCEDURE mysql.p1()BEGIN  UPDATE mysql.t1 SET counter = counter + 1;
  SELECT counter FROM mysql.t1;
END|DELIMITER ;|CALL mysql.p1();
GRANT EXECUTE ON PROCEDURE mysql.p1 TO u2@localhost;
ALTER USER u1@localhost ACCOUNT LOCK;
connect(u1_con,localhost,u1,pass);
connect(u2_con,localhost,u2,pass);
SELECT CURRENT_USER();
CALL mysql.p1();
disconnect u2_con;
connection default;
FLUSH STATUS;
CREATE USER 'u3'@'localhost' IDENTIFIED BY 'pass' ACCOUNT LOCK;
SHOW STATUS LIKE 'Locked_connects';
disable_query_log;
while ($1) {      connect(unlocked_user_con, localhost, u3, pass);
  connection default;
  ALTER USER u3@localhost ACCOUNT UNLOCK;
  connect(unlocked_user_con, localhost, u3, pass);
  disconnect unlocked_user_con;
  connection default;
  ALTER USER u3@localhost ACCOUNT LOCK;
  dec $1;
enable_query_log;
connection default;
SHOW STATUS LIKE 'Locked_connects';
FLUSH STATUS;
connection default;
CREATE USER u1@localhost REQUIRE NONE ACCOUNT LOCK WITH MAX_QUERIES_PER_HOUR 100;
DROP USER u1@localhost;
CREATE USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 100 ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 99 ACCOUNT UNLOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 98 PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK WITH MAX_QUERIES_PER_HOUR 97 PASSWORD EXPIRE;
DROP USER u1@localhost;
CREATE USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT LOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE NEVER ACCOUNT LOCK PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
                         "Expected .*, found .*. "                         "The table is probably corrupted");
connection default;
CREATE TABLE mysql.temp_user LIKE mysql.user;
INSERT INTO mysql.temp_user SELECT * FROM mysql.user;
ALTER TABLE mysql.user DROP COLUMN account_locked;
ALTER TABLE mysql.user DROP COLUMN create_role_priv;
ALTER TABLE mysql.user DROP COLUMN drop_role_priv;
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass';
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
SELECT user, account_locked FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
connection default;
ALTER USER backuser@localhost ACCOUNT LOCK;
ALTER USER backuser@localhost ACCOUNT UNLOCK;
DROP USER backuser@localhost;
DROP TABLE mysql.user;
ALTER TABLE mysql.temp_user RENAME mysql.user;
FLUSH PRIVILEGES;
connection default;
CREATE DATABASE account;
CREATE TABLE account.`account` (account text(20));
INSERT INTO `account`.account VALUES("account");
SELECT account FROM account.account WHERE account = 'account';
SET @account = "account_before";
delimiter |;
CREATE PROCEDURE account.account(OUT ac CHAR(20))BEGIN      if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
     SELECT account.`account`.account INTO ac FROM account.account;
END|delimiter ;|CALL account.account(@account);
SELECT @account;
DROP DATABASE account;
CREATE USER ACCOUNT@localhost ACCOUNT LOCK;
DROP USER ACCOUNT@localhost;
connection default;
DROP PROCEDURE mysql.p1;
DROP TABLE mysql.t1;
DROP USER u1@localhost;
DROP USER u2@localhost;
DROP USER u3@localhost;
CREATE USER u1 IDENTIFIED BY 'pass';
SHOW CREATE USER u1;
ALTER USER u1 ACCOUNT LOCK;
SHOW CREATE USER u1;
DROP USER u1;
TRUNCATE TABLE mysql.general_log;
SET @old_log_output=          @@global.log_output;
SET @old_general_log=         @@global.general_log;
SET @old_general_log_file=    @@global.general_log_file;
eval SET GLOBAL general_log_file = '$MYSQLTEST_VARDIR/log/rewrite_general.log';
SET GLOBAL log_output =       'FILE,TABLE';
SET GLOBAL general_log=       'ON';
CREATE USER u1 IDENTIFIED BY 'pass';
CREATE USER u2 IDENTIFIED BY 'pass' ACCOUNT LOCK;
CREATE USER u3 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u1 IDENTIFIED BY 'pass';
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u2 IDENTIFIED BY 'pass';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'CREATE USER %' AND                                             command_type NOT LIKE 'Prepare';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'ALTER USER %'AND                                             command_type NOT LIKE 'Prepare';
DROP USER u1, u2, u3;
SET GLOBAL general_log_file=  @old_general_log_file;
SET GLOBAL general_log=       @old_general_log;
SET GLOBAL log_output=        @old_log_output;
TRUNCATE TABLE mysql.general_log;
connection default;
CREATE USER unlocked_user@localhost IDENTIFIED BY 'pas';
SELECT account_locked FROM mysql.user  WHERE user='unlocked_user' and host = 'localhost';
SELECT CURRENT_USER();
connection default;
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
disconnect unlocked_user_con;
SELECT CURRENT_USER();
connection default;
FLUSH PRIVILEGES;
connection unlocked_user_con;
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
UPDATE mysql.user SET account_locked='y'  WHERE user='unlocked_user' and host = 'localhost';
FLUSH PRIVILEGES;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT UNLOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
connection default;
CREATE USER unlocked_user2@localhost IDENTIFIED BY 'pas';
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost,           unlocked_user2@localhost ACCOUNT UNLOCK;
SELECT user, account_locked FROM mysql.user  WHERE (user = 'unlocked_user' and host = 'localhost') or        (user = 'unlocked_user2' and host = 'localhost') ORDER BY user;
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
SHOW CREATE USER unlocked_user@localhost;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SHOW CREATE USER unlocked_user@localhost;
connection default;
DROP USER unlocked_user@localhost;
DROP USER unlocked_user2@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER ''@localhost ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost PASSWORD EXPIRE ACCOUNT LOCK;
DROP USER ''@localhost;
connection default;
CREATE user ''@localhost IDENTIFIED BY 'pass';
CREATE USER 'unlocked_user'@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
connection anonymous_user_con;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
disconnect anonymous_user_con;
connection default;
DROP USER unlocked_user@localhost;
DROP USER ''@localhost;
connection default;
CREATE USER u1@localhost IDENTIFIED BY 'pass';
CREATE USER u2@localhost IDENTIFIED BY 'pass';
GRANT ALL ON *.* TO u1@localhost;
DELIMITER |;
CREATE TABLE mysql.t1(counter INT)|INSERT INTO mysql.t1 VALUES(0)|CREATE DEFINER = u1@localhost PROCEDURE mysql.p1()BEGIN  UPDATE mysql.t1 SET counter = counter + 1;
  SELECT counter FROM mysql.t1;
END|DELIMITER ;|CALL mysql.p1();
GRANT EXECUTE ON PROCEDURE mysql.p1 TO u2@localhost;
ALTER USER u1@localhost ACCOUNT LOCK;
connect(u1_con,localhost,u1,pass);
connect(u2_con,localhost,u2,pass);
SELECT CURRENT_USER();
CALL mysql.p1();
disconnect u2_con;
connection default;
FLUSH STATUS;
CREATE USER 'u3'@'localhost' IDENTIFIED BY 'pass' ACCOUNT LOCK;
SHOW STATUS LIKE 'Locked_connects';
disable_query_log;
while ($1) {      connect(unlocked_user_con, localhost, u3, pass);
  connection default;
  ALTER USER u3@localhost ACCOUNT UNLOCK;
  connect(unlocked_user_con, localhost, u3, pass);
  disconnect unlocked_user_con;
  connection default;
  ALTER USER u3@localhost ACCOUNT LOCK;
  dec $1;
enable_query_log;
connection default;
SHOW STATUS LIKE 'Locked_connects';
FLUSH STATUS;
connection default;
CREATE USER u1@localhost REQUIRE NONE ACCOUNT LOCK WITH MAX_QUERIES_PER_HOUR 100;
DROP USER u1@localhost;
CREATE USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 100 ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 99 ACCOUNT UNLOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 98 PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK WITH MAX_QUERIES_PER_HOUR 97 PASSWORD EXPIRE;
DROP USER u1@localhost;
CREATE USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT LOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE NEVER ACCOUNT LOCK PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
                         "Expected .*, found .*. "                         "The table is probably corrupted");
connection default;
CREATE TABLE mysql.temp_user LIKE mysql.user;
INSERT INTO mysql.temp_user SELECT * FROM mysql.user;
ALTER TABLE mysql.user DROP COLUMN account_locked;
ALTER TABLE mysql.user DROP COLUMN create_role_priv;
ALTER TABLE mysql.user DROP COLUMN drop_role_priv;
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass';
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
SELECT user, account_locked FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
connection default;
ALTER USER backuser@localhost ACCOUNT LOCK;
ALTER USER backuser@localhost ACCOUNT UNLOCK;
DROP USER backuser@localhost;
DROP TABLE mysql.user;
ALTER TABLE mysql.temp_user RENAME mysql.user;
FLUSH PRIVILEGES;
connection default;
CREATE DATABASE account;
CREATE TABLE account.`account` (account text(20));
INSERT INTO `account`.account VALUES("account");
SELECT account FROM account.account WHERE account = 'account';
SET @account = "account_before";
delimiter |;
CREATE PROCEDURE account.account(OUT ac CHAR(20))BEGIN      if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
     SELECT account.`account`.account INTO ac FROM account.account;
END|delimiter ;|CALL account.account(@account);
SELECT @account;
DROP DATABASE account;
CREATE USER ACCOUNT@localhost ACCOUNT LOCK;
DROP USER ACCOUNT@localhost;
connection default;
DROP PROCEDURE mysql.p1;
DROP TABLE mysql.t1;
DROP USER u1@localhost;
DROP USER u2@localhost;
DROP USER u3@localhost;
CREATE USER u1 IDENTIFIED BY 'pass';
SHOW CREATE USER u1;
ALTER USER u1 ACCOUNT LOCK;
SHOW CREATE USER u1;
DROP USER u1;
TRUNCATE TABLE mysql.general_log;
SET @old_log_output=          @@global.log_output;
SET @old_general_log=         @@global.general_log;
SET @old_general_log_file=    @@global.general_log_file;
eval SET GLOBAL general_log_file = '$MYSQLTEST_VARDIR/log/rewrite_general.log';
SET GLOBAL log_output =       'FILE,TABLE';
SET GLOBAL general_log=       'ON';
CREATE USER u1 IDENTIFIED BY 'pass';
CREATE USER u2 IDENTIFIED BY 'pass' ACCOUNT LOCK;
CREATE USER u3 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u1 IDENTIFIED BY 'pass';
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u2 IDENTIFIED BY 'pass';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'CREATE USER %' AND                                             command_type NOT LIKE 'Prepare';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'ALTER USER %'AND                                             command_type NOT LIKE 'Prepare';
DROP USER u1, u2, u3;
SET GLOBAL general_log_file=  @old_general_log_file;
SET GLOBAL general_log=       @old_general_log;
SET GLOBAL log_output=        @old_log_output;
TRUNCATE TABLE mysql.general_log;
connection default;
CREATE USER unlocked_user@localhost IDENTIFIED BY 'pas';
SELECT account_locked FROM mysql.user  WHERE user='unlocked_user' and host = 'localhost';
SELECT CURRENT_USER();
connection default;
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
disconnect unlocked_user_con;
SELECT CURRENT_USER();
connection default;
FLUSH PRIVILEGES;
connection unlocked_user_con;
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
UPDATE mysql.user SET account_locked='y'  WHERE user='unlocked_user' and host = 'localhost';
FLUSH PRIVILEGES;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT UNLOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
connection default;
CREATE USER unlocked_user2@localhost IDENTIFIED BY 'pas';
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost,           unlocked_user2@localhost ACCOUNT UNLOCK;
SELECT user, account_locked FROM mysql.user  WHERE (user = 'unlocked_user' and host = 'localhost') or        (user = 'unlocked_user2' and host = 'localhost') ORDER BY user;
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
SHOW CREATE USER unlocked_user@localhost;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SHOW CREATE USER unlocked_user@localhost;
connection default;
DROP USER unlocked_user@localhost;
DROP USER unlocked_user2@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER ''@localhost ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost PASSWORD EXPIRE ACCOUNT LOCK;
DROP USER ''@localhost;
connection default;
CREATE user ''@localhost IDENTIFIED BY 'pass';
CREATE USER 'unlocked_user'@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
connection anonymous_user_con;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
disconnect anonymous_user_con;
connection default;
DROP USER unlocked_user@localhost;
DROP USER ''@localhost;
connection default;
CREATE USER u1@localhost IDENTIFIED BY 'pass';
CREATE USER u2@localhost IDENTIFIED BY 'pass';
GRANT ALL ON *.* TO u1@localhost;
DELIMITER |;
CREATE TABLE mysql.t1(counter INT)|INSERT INTO mysql.t1 VALUES(0)|CREATE DEFINER = u1@localhost PROCEDURE mysql.p1()BEGIN  UPDATE mysql.t1 SET counter = counter + 1;
  SELECT counter FROM mysql.t1;
END|DELIMITER ;|CALL mysql.p1();
GRANT EXECUTE ON PROCEDURE mysql.p1 TO u2@localhost;
ALTER USER u1@localhost ACCOUNT LOCK;
connect(u1_con,localhost,u1,pass);
connect(u2_con,localhost,u2,pass);
SELECT CURRENT_USER();
CALL mysql.p1();
disconnect u2_con;
connection default;
FLUSH STATUS;
CREATE USER 'u3'@'localhost' IDENTIFIED BY 'pass' ACCOUNT LOCK;
SHOW STATUS LIKE 'Locked_connects';
disable_query_log;
while ($1) {      connect(unlocked_user_con, localhost, u3, pass);
  connection default;
  ALTER USER u3@localhost ACCOUNT UNLOCK;
  connect(unlocked_user_con, localhost, u3, pass);
  disconnect unlocked_user_con;
  connection default;
  ALTER USER u3@localhost ACCOUNT LOCK;
  dec $1;
enable_query_log;
connection default;
SHOW STATUS LIKE 'Locked_connects';
FLUSH STATUS;
connection default;
CREATE USER u1@localhost REQUIRE NONE ACCOUNT LOCK WITH MAX_QUERIES_PER_HOUR 100;
DROP USER u1@localhost;
CREATE USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 100 ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 99 ACCOUNT UNLOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 98 PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK WITH MAX_QUERIES_PER_HOUR 97 PASSWORD EXPIRE;
DROP USER u1@localhost;
CREATE USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT LOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE NEVER ACCOUNT LOCK PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
                         "Expected .*, found .*. "                         "The table is probably corrupted");
connection default;
CREATE TABLE mysql.temp_user LIKE mysql.user;
INSERT INTO mysql.temp_user SELECT * FROM mysql.user;
ALTER TABLE mysql.user DROP COLUMN account_locked;
ALTER TABLE mysql.user DROP COLUMN create_role_priv;
ALTER TABLE mysql.user DROP COLUMN drop_role_priv;
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass';
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
SELECT user, account_locked FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
connection default;
ALTER USER backuser@localhost ACCOUNT LOCK;
ALTER USER backuser@localhost ACCOUNT UNLOCK;
DROP USER backuser@localhost;
DROP TABLE mysql.user;
ALTER TABLE mysql.temp_user RENAME mysql.user;
FLUSH PRIVILEGES;
connection default;
CREATE DATABASE account;
CREATE TABLE account.`account` (account text(20));
INSERT INTO `account`.account VALUES("account");
SELECT account FROM account.account WHERE account = 'account';
SET @account = "account_before";
delimiter |;
CREATE PROCEDURE account.account(OUT ac CHAR(20))BEGIN      if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
     SELECT account.`account`.account INTO ac FROM account.account;
END|delimiter ;|CALL account.account(@account);
SELECT @account;
DROP DATABASE account;
CREATE USER ACCOUNT@localhost ACCOUNT LOCK;
DROP USER ACCOUNT@localhost;
connection default;
DROP PROCEDURE mysql.p1;
DROP TABLE mysql.t1;
DROP USER u1@localhost;
DROP USER u2@localhost;
DROP USER u3@localhost;
CREATE USER u1 IDENTIFIED BY 'pass';
SHOW CREATE USER u1;
ALTER USER u1 ACCOUNT LOCK;
SHOW CREATE USER u1;
DROP USER u1;
TRUNCATE TABLE mysql.general_log;
SET @old_log_output=          @@global.log_output;
SET @old_general_log=         @@global.general_log;
SET @old_general_log_file=    @@global.general_log_file;
eval SET GLOBAL general_log_file = '$MYSQLTEST_VARDIR/log/rewrite_general.log';
SET GLOBAL log_output =       'FILE,TABLE';
SET GLOBAL general_log=       'ON';
CREATE USER u1 IDENTIFIED BY 'pass';
CREATE USER u2 IDENTIFIED BY 'pass' ACCOUNT LOCK;
CREATE USER u3 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u1 IDENTIFIED BY 'pass';
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u2 IDENTIFIED BY 'pass';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'CREATE USER %' AND                                             command_type NOT LIKE 'Prepare';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'ALTER USER %'AND                                             command_type NOT LIKE 'Prepare';
DROP USER u1, u2, u3;
SET GLOBAL general_log_file=  @old_general_log_file;
SET GLOBAL general_log=       @old_general_log;
SET GLOBAL log_output=        @old_log_output;
TRUNCATE TABLE mysql.general_log;
connection default;
CREATE USER unlocked_user@localhost IDENTIFIED BY 'pas';
SELECT account_locked FROM mysql.user  WHERE user='unlocked_user' and host = 'localhost';
SELECT CURRENT_USER();
connection default;
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
disconnect unlocked_user_con;
SELECT CURRENT_USER();
connection default;
FLUSH PRIVILEGES;
connection unlocked_user_con;
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
UPDATE mysql.user SET account_locked='y'  WHERE user='unlocked_user' and host = 'localhost';
FLUSH PRIVILEGES;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT UNLOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
connection default;
CREATE USER unlocked_user2@localhost IDENTIFIED BY 'pas';
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost,           unlocked_user2@localhost ACCOUNT UNLOCK;
SELECT user, account_locked FROM mysql.user  WHERE (user = 'unlocked_user' and host = 'localhost') or        (user = 'unlocked_user2' and host = 'localhost') ORDER BY user;
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
SHOW CREATE USER unlocked_user@localhost;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SHOW CREATE USER unlocked_user@localhost;
connection default;
DROP USER unlocked_user@localhost;
DROP USER unlocked_user2@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER ''@localhost ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost PASSWORD EXPIRE ACCOUNT LOCK;
DROP USER ''@localhost;
connection default;
CREATE user ''@localhost IDENTIFIED BY 'pass';
CREATE USER 'unlocked_user'@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
connection anonymous_user_con;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
disconnect anonymous_user_con;
connection default;
DROP USER unlocked_user@localhost;
DROP USER ''@localhost;
connection default;
CREATE USER u1@localhost IDENTIFIED BY 'pass';
CREATE USER u2@localhost IDENTIFIED BY 'pass';
GRANT ALL ON *.* TO u1@localhost;
DELIMITER |;
CREATE TABLE mysql.t1(counter INT)|INSERT INTO mysql.t1 VALUES(0)|CREATE DEFINER = u1@localhost PROCEDURE mysql.p1()BEGIN  UPDATE mysql.t1 SET counter = counter + 1;
  SELECT counter FROM mysql.t1;
END|DELIMITER ;|CALL mysql.p1();
GRANT EXECUTE ON PROCEDURE mysql.p1 TO u2@localhost;
ALTER USER u1@localhost ACCOUNT LOCK;
connect(u1_con,localhost,u1,pass);
connect(u2_con,localhost,u2,pass);
SELECT CURRENT_USER();
CALL mysql.p1();
disconnect u2_con;
connection default;
FLUSH STATUS;
CREATE USER 'u3'@'localhost' IDENTIFIED BY 'pass' ACCOUNT LOCK;
SHOW STATUS LIKE 'Locked_connects';
disable_query_log;
while ($1) {      connect(unlocked_user_con, localhost, u3, pass);
  connection default;
  ALTER USER u3@localhost ACCOUNT UNLOCK;
  connect(unlocked_user_con, localhost, u3, pass);
  disconnect unlocked_user_con;
  connection default;
  ALTER USER u3@localhost ACCOUNT LOCK;
  dec $1;
enable_query_log;
connection default;
SHOW STATUS LIKE 'Locked_connects';
FLUSH STATUS;
connection default;
CREATE USER u1@localhost REQUIRE NONE ACCOUNT LOCK WITH MAX_QUERIES_PER_HOUR 100;
DROP USER u1@localhost;
CREATE USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 100 ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 99 ACCOUNT UNLOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 98 PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK WITH MAX_QUERIES_PER_HOUR 97 PASSWORD EXPIRE;
DROP USER u1@localhost;
CREATE USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT LOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE NEVER ACCOUNT LOCK PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
                         "Expected .*, found .*. "                         "The table is probably corrupted");
connection default;
CREATE TABLE mysql.temp_user LIKE mysql.user;
INSERT INTO mysql.temp_user SELECT * FROM mysql.user;
ALTER TABLE mysql.user DROP COLUMN account_locked;
ALTER TABLE mysql.user DROP COLUMN create_role_priv;
ALTER TABLE mysql.user DROP COLUMN drop_role_priv;
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass';
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
SELECT user, account_locked FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
connection default;
ALTER USER backuser@localhost ACCOUNT LOCK;
ALTER USER backuser@localhost ACCOUNT UNLOCK;
DROP USER backuser@localhost;
DROP TABLE mysql.user;
ALTER TABLE mysql.temp_user RENAME mysql.user;
FLUSH PRIVILEGES;
connection default;
CREATE DATABASE account;
CREATE TABLE account.`account` (account text(20));
INSERT INTO `account`.account VALUES("account");
SELECT account FROM account.account WHERE account = 'account';
SET @account = "account_before";
delimiter |;
CREATE PROCEDURE account.account(OUT ac CHAR(20))BEGIN      if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
     SELECT account.`account`.account INTO ac FROM account.account;
END|delimiter ;|CALL account.account(@account);
SELECT @account;
DROP DATABASE account;
CREATE USER ACCOUNT@localhost ACCOUNT LOCK;
DROP USER ACCOUNT@localhost;
connection default;
DROP PROCEDURE mysql.p1;
DROP TABLE mysql.t1;
DROP USER u1@localhost;
DROP USER u2@localhost;
DROP USER u3@localhost;
CREATE USER u1 IDENTIFIED BY 'pass';
SHOW CREATE USER u1;
ALTER USER u1 ACCOUNT LOCK;
SHOW CREATE USER u1;
DROP USER u1;
TRUNCATE TABLE mysql.general_log;
SET @old_log_output=          @@global.log_output;
SET @old_general_log=         @@global.general_log;
SET @old_general_log_file=    @@global.general_log_file;
eval SET GLOBAL general_log_file = '$MYSQLTEST_VARDIR/log/rewrite_general.log';
SET GLOBAL log_output =       'FILE,TABLE';
SET GLOBAL general_log=       'ON';
CREATE USER u1 IDENTIFIED BY 'pass';
CREATE USER u2 IDENTIFIED BY 'pass' ACCOUNT LOCK;
CREATE USER u3 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u1 IDENTIFIED BY 'pass';
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u2 IDENTIFIED BY 'pass';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'CREATE USER %' AND                                             command_type NOT LIKE 'Prepare';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'ALTER USER %'AND                                             command_type NOT LIKE 'Prepare';
DROP USER u1, u2, u3;
SET GLOBAL general_log_file=  @old_general_log_file;
SET GLOBAL general_log=       @old_general_log;
SET GLOBAL log_output=        @old_log_output;
TRUNCATE TABLE mysql.general_log;
connection default;
CREATE USER unlocked_user@localhost IDENTIFIED BY 'pas';
SELECT account_locked FROM mysql.user  WHERE user='unlocked_user' and host = 'localhost';
SELECT CURRENT_USER();
connection default;
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
disconnect unlocked_user_con;
SELECT CURRENT_USER();
connection default;
FLUSH PRIVILEGES;
connection unlocked_user_con;
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
UPDATE mysql.user SET account_locked='y'  WHERE user='unlocked_user' and host = 'localhost';
FLUSH PRIVILEGES;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT UNLOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SELECT account_locked FROM mysql.user  WHERE user = 'unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pas);
connection default;
CREATE USER unlocked_user2@localhost IDENTIFIED BY 'pas';
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
ALTER USER unlocked_user@localhost,           unlocked_user2@localhost ACCOUNT UNLOCK;
SELECT user, account_locked FROM mysql.user  WHERE (user = 'unlocked_user' and host = 'localhost') or        (user = 'unlocked_user2' and host = 'localhost') ORDER BY user;
connect(unlocked_user_con, localhost, unlocked_user2, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connect(unlocked_user_con, localhost, unlocked_user, pas);
SELECT CURRENT_USER();
disconnect unlocked_user_con;
connection default;
SHOW CREATE USER unlocked_user@localhost;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
SHOW CREATE USER unlocked_user@localhost;
connection default;
DROP USER unlocked_user@localhost;
DROP USER unlocked_user2@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost ACCOUNT LOCK;
connect(anonymous_user_con, localhost, '', pass);
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER ''@localhost ACCOUNT UNLOCK;
connect(anonymous_user_con, localhost, '', pass);
SELECT CURRENT_USER();
disconnect anonymous_user_con;
connection default;
DROP USER ''@localhost;
connection default;
CREATE USER ''@localhost IDENTIFIED BY 'pass';
ALTER USER ''@localhost PASSWORD EXPIRE ACCOUNT LOCK;
DROP USER ''@localhost;
connection default;
CREATE user ''@localhost IDENTIFIED BY 'pass';
CREATE USER 'unlocked_user'@localhost IDENTIFIED BY 'pass';
connect(anonymous_user_con, localhost, '', pass);
UPDATE mysql.user SET account_locked='Y'  WHERE user='unlocked_user' and host = 'localhost';
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
connection anonymous_user_con;
ALTER USER unlocked_user@localhost ACCOUNT LOCK;
connect(unlocked_user_con, localhost, unlocked_user, pass);
disconnect unlocked_user_con;
disconnect anonymous_user_con;
connection default;
DROP USER unlocked_user@localhost;
DROP USER ''@localhost;
connection default;
CREATE USER u1@localhost IDENTIFIED BY 'pass';
CREATE USER u2@localhost IDENTIFIED BY 'pass';
GRANT ALL ON *.* TO u1@localhost;
DELIMITER |;
CREATE TABLE mysql.t1(counter INT)|INSERT INTO mysql.t1 VALUES(0)|CREATE DEFINER = u1@localhost PROCEDURE mysql.p1()BEGIN  UPDATE mysql.t1 SET counter = counter + 1;
  SELECT counter FROM mysql.t1;
END|DELIMITER ;|CALL mysql.p1();
GRANT EXECUTE ON PROCEDURE mysql.p1 TO u2@localhost;
ALTER USER u1@localhost ACCOUNT LOCK;
connect(u1_con,localhost,u1,pass);
connect(u2_con,localhost,u2,pass);
SELECT CURRENT_USER();
CALL mysql.p1();
disconnect u2_con;
connection default;
FLUSH STATUS;
CREATE USER 'u3'@'localhost' IDENTIFIED BY 'pass' ACCOUNT LOCK;
SHOW STATUS LIKE 'Locked_connects';
disable_query_log;
while ($1) {      connect(unlocked_user_con, localhost, u3, pass);
  connection default;
  ALTER USER u3@localhost ACCOUNT UNLOCK;
  connect(unlocked_user_con, localhost, u3, pass);
  disconnect unlocked_user_con;
  connection default;
  ALTER USER u3@localhost ACCOUNT LOCK;
  dec $1;
enable_query_log;
connection default;
SHOW STATUS LIKE 'Locked_connects';
FLUSH STATUS;
connection default;
CREATE USER u1@localhost REQUIRE NONE ACCOUNT LOCK WITH MAX_QUERIES_PER_HOUR 100;
DROP USER u1@localhost;
CREATE USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 100 ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 99 ACCOUNT UNLOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 98 PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK WITH MAX_QUERIES_PER_HOUR 97 PASSWORD EXPIRE;
DROP USER u1@localhost;
CREATE USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
DROP USER u1@localhost;
CREATE USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost IDENTIFIED BY 'PASS' ACCOUNT LOCK ACCOUNT UNLOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT UNLOCK ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost ACCOUNT LOCK PASSWORD EXPIRE ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE ACCOUNT LOCK PASSWORD EXPIRE NEVER;
SHOW CREATE USER u1@localhost;
ALTER USER u1@localhost PASSWORD EXPIRE NEVER ACCOUNT LOCK PASSWORD EXPIRE INTERVAL 5 DAY ACCOUNT LOCK;
SHOW CREATE USER u1@localhost;
                         "Expected .*, found .*. "                         "The table is probably corrupted");
connection default;
CREATE TABLE mysql.temp_user LIKE mysql.user;
INSERT INTO mysql.temp_user SELECT * FROM mysql.user;
ALTER TABLE mysql.user DROP COLUMN account_locked;
ALTER TABLE mysql.user DROP COLUMN create_role_priv;
ALTER TABLE mysql.user DROP COLUMN drop_role_priv;
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT LOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
CREATE USER backuser@localhost IDENTIFIED BY 'pass';
SELECT COUNT(*) FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
SELECT user, account_locked FROM mysql.user WHERE (user = 'backuser' and host = 'localhost');
connection default;
ALTER USER backuser@localhost ACCOUNT LOCK;
ALTER USER backuser@localhost ACCOUNT UNLOCK;
DROP USER backuser@localhost;
DROP TABLE mysql.user;
ALTER TABLE mysql.temp_user RENAME mysql.user;
FLUSH PRIVILEGES;
connection default;
CREATE DATABASE account;
CREATE TABLE account.`account` (account text(20));
INSERT INTO `account`.account VALUES("account");
SELECT account FROM account.account WHERE account = 'account';
SET @account = "account_before";
delimiter |;
CREATE PROCEDURE account.account(OUT ac CHAR(20))BEGIN      if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
     SELECT account.`account`.account INTO ac FROM account.account;
END|delimiter ;|CALL account.account(@account);
SELECT @account;
DROP DATABASE account;
CREATE USER ACCOUNT@localhost ACCOUNT LOCK;
DROP USER ACCOUNT@localhost;
connection default;
DROP PROCEDURE mysql.p1;
DROP TABLE mysql.t1;
DROP USER u1@localhost;
DROP USER u2@localhost;
DROP USER u3@localhost;
CREATE USER u1 IDENTIFIED BY 'pass';
SHOW CREATE USER u1;
ALTER USER u1 ACCOUNT LOCK;
SHOW CREATE USER u1;
DROP USER u1;
TRUNCATE TABLE mysql.general_log;
SET @old_log_output=          @@global.log_output;
SET @old_general_log=         @@global.general_log;
SET @old_general_log_file=    @@global.general_log_file;
eval SET GLOBAL general_log_file = '$MYSQLTEST_VARDIR/log/rewrite_general.log';
SET GLOBAL log_output =       'FILE,TABLE';
SET GLOBAL general_log=       'ON';
CREATE USER u1 IDENTIFIED BY 'pass';
CREATE USER u2 IDENTIFIED BY 'pass' ACCOUNT LOCK;
CREATE USER u3 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u1 IDENTIFIED BY 'pass';
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT LOCK;
ALTER USER u1 IDENTIFIED BY 'pass' ACCOUNT UNLOCK;
ALTER USER u2 IDENTIFIED BY 'pass';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'CREATE USER %' AND                                             command_type NOT LIKE 'Prepare';
SELECT argument FROM mysql.general_log WHERE argument LIKE 'ALTER USER %'AND                                             command_type NOT LIKE 'Prepare';
DROP USER u1, u2, u3;
SET GLOBAL general_log_file=  @old_general_log_file;
SET GLOBAL general_log=       @old_general_log;
SET GLOBAL log_output=        @old_log_output;
TRUNCATE TABLE mysql.general_log;
