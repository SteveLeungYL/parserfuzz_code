   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   DROP TABLE IF EXISTS t1;
connect (con1,localhost,root,,);
connect (con2,localhost,root,,);
connection con1;
CREATE TABLE t1 (a INT) ENGINE=innodb;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was set as expected, weCOMMIT;
DELETE FROM t1;
START TRANSACTION; # Now we omit WITH CONSISTENT SNAPSHOTconnection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
DELETE FROM t1;
COMMIT WORK AND CHAIN;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
connection default;
disconnect con1;
disconnect con2;
DROP TABLE t1;
   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   DROP TABLE IF EXISTS t1;
connect (con1,localhost,root,,);
connect (con2,localhost,root,,);
connection con1;
CREATE TABLE t1 (a INT) ENGINE=innodb;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was set as expected, weCOMMIT;
DELETE FROM t1;
START TRANSACTION; # Now we omit WITH CONSISTENT SNAPSHOTconnection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
DELETE FROM t1;
COMMIT WORK AND CHAIN;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
connection default;
disconnect con1;
disconnect con2;
DROP TABLE t1;
   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   DROP TABLE IF EXISTS t1;
connect (con1,localhost,root,,);
connect (con2,localhost,root,,);
connection con1;
CREATE TABLE t1 (a INT) ENGINE=innodb;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was set as expected, weCOMMIT;
DELETE FROM t1;
START TRANSACTION; # Now we omit WITH CONSISTENT SNAPSHOTconnection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
DELETE FROM t1;
COMMIT WORK AND CHAIN;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
connection default;
disconnect con1;
disconnect con2;
DROP TABLE t1;
   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   DROP TABLE IF EXISTS t1;
connect (con1,localhost,root,,);
connect (con2,localhost,root,,);
connection con1;
CREATE TABLE t1 (a INT) ENGINE=innodb;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was set as expected, weCOMMIT;
DELETE FROM t1;
START TRANSACTION; # Now we omit WITH CONSISTENT SNAPSHOTconnection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
DELETE FROM t1;
COMMIT WORK AND CHAIN;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
connection default;
disconnect con1;
disconnect con2;
DROP TABLE t1;
   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   DROP TABLE IF EXISTS t1;
connect (con1,localhost,root,,);
connect (con2,localhost,root,,);
connection con1;
CREATE TABLE t1 (a INT) ENGINE=innodb;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was set as expected, weCOMMIT;
DELETE FROM t1;
START TRANSACTION; # Now we omit WITH CONSISTENT SNAPSHOTconnection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
DELETE FROM t1;
COMMIT WORK AND CHAIN;
connection con2;
INSERT INTO t1 VALUES(1);
connection con1;
SELECT * FROM t1; # if consistent snapshot was not set, as expected, weCOMMIT;
connection default;
disconnect con1;
disconnect con2;
DROP TABLE t1;
