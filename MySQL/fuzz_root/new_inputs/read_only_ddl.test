    create table t_alter(i int);
insert into t_alter values(1);
write_file $INIT_SQL;
create table test.t_create as select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
alter table test.t_alter comment = 'new comment';
EOFcreate user nonsuper@localhost;
grant CREATE, SELECT, DROP on *.* to nonsuper@localhost;
enable_connect_log;
connect (con_nonsuper, localhost, nonsuper,, test);
enable_reconnect;
connect (con_super, localhost, root,, test);
enable_reconnect;
replace_result $MYSQLD_LOG MYSQLD_LOG $INIT_SQL INIT_SQL;
source include/restart_mysqld.inc;
source include/wait_until_connected_again.inc;
select * from t_create;
drop table t_create;
show create table t_alter;
alter table t_alter comment = '';
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
connection con_nonsuper;
create table t_create (a int);
alter table t_alter comment = 'new comment';
connection con_super;
create table t_create (a int);
drop table t_create;
alter table t_alter comment = 'new comment';
alter table t_alter comment = '';
replace_result $MYSQLD_LOG MYSQLD_LOG $INIT_SQL INIT_SQL;
source include/restart_mysqld.inc;
source include/wait_until_connected_again.inc;
set @@global.super_read_only = 0;
select * from t_create;
drop table t_create;
show create table t_alter;
alter table t_alter comment = '';
set @@global.super_read_only = 1;
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
connection con_nonsuper;
create table t_create (a int);
alter table t_alter comment = 'new comment';
connection con_super;
create table t_create (a int);
alter table t_alter comment = 'new comment';
replace_result $MYSQLD_LOG MYSQLD_LOG $INIT_SQL INIT_SQL;
source include/restart_mysqld.inc;
source include/wait_until_connected_again.inc;
set @@session.transaction_read_only = 0;
select * from t_create;
drop table t_create;
show create table t_alter;
alter table t_alter comment = '';
set @@session.transaction_read_only = 1;
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
connection con_nonsuper;
create table t_create (a int);
alter table t_alter comment = 'new comment';
connection con_super;
create table t_create (a int);
alter table t_alter comment = 'new comment';
replace_result $MYSQLD_LOG MYSQLD_LOG $INIT_SQL INIT_SQL;
source include/restart_mysqld.inc;
source include/wait_until_connected_again.inc;
source include/search_pattern.inc;
select * from t_create;
show create table t_alter;
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
connection con_nonsuper;
create table t_create (a int);
alter table t_alter comment = 'new comment';
connection con_super;
create table t_create (a int);
alter table t_alter comment = 'new comment';
copy_file $MYSQLTEST_VARDIR/std_data/upgrade/data_$VERSION.zip $MYSQL_TMP_DIR/data_$VERSION.zip;
file_exists $MYSQL_TMP_DIR/data_$VERSION.zip;
exec unzip -qo $MYSQL_TMP_DIR/data_$VERSION.zip -d $MYSQL_TMP_DIR;
replace_result $MYSQLD_LOG MYSQLD_LOG $MYSQLD_DATADIR MYSQLD_DATADIR;
source include/restart_mysqld.inc;
source include/wait_until_connected_again.inc;
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
source include/shutdown_mysqld.inc;
force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
exec unzip -qo $MYSQL_TMP_DIR/data_$VERSION.zip -d $MYSQL_TMP_DIR;
replace_result $MYSQLD_LOG MYSQLD_LOG $MYSQLD_DATADIR MYSQLD_DATADIR;
source include/start_mysqld.inc;
source include/wait_until_connected_again.inc;
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
source include/shutdown_mysqld.inc;
force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
exec unzip -qo $MYSQL_TMP_DIR/data_$VERSION.zip -d $MYSQL_TMP_DIR;
replace_result $MYSQLD_LOG MYSQLD_LOG $MYSQLD_DATADIR MYSQLD_DATADIR;
source include/start_mysqld.inc;
source include/wait_until_connected_again.inc;
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
source include/shutdown_mysqld.inc;
force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
exec unzip -qo $MYSQL_TMP_DIR/data_$VERSION.zip -d $MYSQL_TMP_DIR;
exec $MYSQLD source include/search_pattern.inc;
force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
remove_file $MYSQL_TMP_DIR/data_$VERSION.zip;
copy_file $MYSQLTEST_VARDIR/std_data/upgrade/data_$VERSION.zip $MYSQL_TMP_DIR/data_$VERSION.zip;
file_exists $MYSQL_TMP_DIR/data_$VERSION.zip;
exec unzip -qo $MYSQL_TMP_DIR/data_$VERSION.zip -d $MYSQL_TMP_DIR;
replace_result $MYSQLD_LOG MYSQLD_LOG $MYSQLD_DATADIR MYSQLD_DATADIR;
source include/start_mysqld.inc;
source include/wait_until_connected_again.inc;
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
source include/shutdown_mysqld.inc;
force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
exec unzip -qo $MYSQL_TMP_DIR/data_$VERSION.zip -d $MYSQL_TMP_DIR;
replace_result $MYSQLD_LOG MYSQLD_LOG $MYSQLD_DATADIR MYSQLD_DATADIR;
source include/start_mysqld.inc;
source include/wait_until_connected_again.inc;
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
source include/shutdown_mysqld.inc;
force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
exec unzip -qo $MYSQL_TMP_DIR/data_$VERSION.zip -d $MYSQL_TMP_DIR;
replace_result $MYSQLD_LOG MYSQLD_LOG $MYSQLD_DATADIR MYSQLD_DATADIR;
source include/start_mysqld.inc;
source include/wait_until_connected_again.inc;
select @@innodb_read_only, @@transaction_read_only, @@read_only, @@super_read_only;
source include/shutdown_mysqld.inc;
force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
exec unzip -qo $MYSQL_TMP_DIR/data_$VERSION.zip -d $MYSQL_TMP_DIR;
exec $MYSQLD source include/search_pattern.inc;
force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
remove_file $MYSQL_TMP_DIR/data_$VERSION.zip;
exec $MYSQLD force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
exec $MYSQLD force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
exec $MYSQLD force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
exec $MYSQLD source include/search_pattern.inc;
force-rmdir $MYSQL_TMP_DIR/data_$VERSION;
connection default;
disconnect con_nonsuper;
disconnect con_super;
enable_reconnect;
source include/start_mysqld.inc;
source include/wait_until_connected_again.inc;
drop table t_alter;
drop user nonsuper@localhost;
remove_file $INIT_SQL;
