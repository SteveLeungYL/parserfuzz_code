    disable_query_log;
  skip Test requires: 'not_ubsan';
enable_query_log;
   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   DROP TABLE IF EXISTS t1, t2;
connect (ssl_con,localhost,root,,,,,SSL);
create table t1 (a int);
disconnect ssl_con;
while ($count)  connect (ssl_con,localhost,root,,,,,SSL);
  eval insert into t1 values ($count);
  dec $count;
  # This select causes the net buffer to fill as the server sends the results  # but the client doesn't reap the results. The results are larger each time  # through the loop, so that eventually the buffer is completely full  # at the exact moment the server attempts to the close the connection with  # the lock held.  send select * from t1;
  # now send the quit the command so the server will initiate the shutdown.  send_quit ssl_con;
  # if the server is hung, this will hang too:  connect (ssl_con2,localhost,root,,,,,SSL);
  # no hang if we get here, close and retry  disconnect ssl_con2;
  disconnect ssl_con;
connect (ssl_con,localhost,root,,,,,SSL);
drop table t1;
connection default;
disconnect ssl_con;
