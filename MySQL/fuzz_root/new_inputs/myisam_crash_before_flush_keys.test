      perl;
sub skip_test {  # Only relevant on Mac OS X  return 0 unless $^O eq 'darwin';
  my $crep= `defaults read com.apple.CrashReporter DialogType`;
  return 0 if $?;
  chomp ($crep);
  $crep= lc $crep;
  return ($crep eq 'basic' || $crep eq 'developer');
my $skip= skip_test();
open (F, ">" . $ENV{'MYSQL_TMP_DIR'} . "/crashrep.inc");
print F "let \$crashrep= $skip;\n";
close F;
EOF        if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }  SET GLOBAL delay_key_write=ALL;
CREATE TABLE t1(a INT,                 b INT,                 PRIMARY KEY(a , b),                 KEY(b)) ENGINE=MyISAM DELAY_KEY_WRITE = 1;
INSERT INTO t1 VALUES (1,2),(2,3),(3,4),(4,5),(5,6);
SET SESSION debug="d,crash_before_flush_keys";
FLUSH TABLE t1;
CHECK TABLE t1;
DROP TABLE t1;
      perl;
sub skip_test {  # Only relevant on Mac OS X  return 0 unless $^O eq 'darwin';
  my $crep= `defaults read com.apple.CrashReporter DialogType`;
  return 0 if $?;
  chomp ($crep);
  $crep= lc $crep;
  return ($crep eq 'basic' || $crep eq 'developer');
my $skip= skip_test();
open (F, ">" . $ENV{'MYSQL_TMP_DIR'} . "/crashrep.inc");
print F "let \$crashrep= $skip;\n";
close F;
EOF        if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }  SET GLOBAL delay_key_write=ALL;
CREATE TABLE t1(a INT,                 b INT,                 PRIMARY KEY(a , b),                 KEY(b)) ENGINE=MyISAM DELAY_KEY_WRITE = 1;
INSERT INTO t1 VALUES (1,2),(2,3),(3,4),(4,5),(5,6);
SET SESSION debug="d,crash_before_flush_keys";
FLUSH TABLE t1;
CHECK TABLE t1;
DROP TABLE t1;
      perl;
sub skip_test {  # Only relevant on Mac OS X  return 0 unless $^O eq 'darwin';
  my $crep= `defaults read com.apple.CrashReporter DialogType`;
  return 0 if $?;
  chomp ($crep);
  $crep= lc $crep;
  return ($crep eq 'basic' || $crep eq 'developer');
my $skip= skip_test();
open (F, ">" . $ENV{'MYSQL_TMP_DIR'} . "/crashrep.inc");
print F "let \$crashrep= $skip;\n";
close F;
EOF        if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }  SET GLOBAL delay_key_write=ALL;
CREATE TABLE t1(a INT,                 b INT,                 PRIMARY KEY(a , b),                 KEY(b)) ENGINE=MyISAM DELAY_KEY_WRITE = 1;
INSERT INTO t1 VALUES (1,2),(2,3),(3,4),(4,5),(5,6);
SET SESSION debug="d,crash_before_flush_keys";
FLUSH TABLE t1;
CHECK TABLE t1;
DROP TABLE t1;
      perl;
sub skip_test {  # Only relevant on Mac OS X  return 0 unless $^O eq 'darwin';
  my $crep= `defaults read com.apple.CrashReporter DialogType`;
  return 0 if $?;
  chomp ($crep);
  $crep= lc $crep;
  return ($crep eq 'basic' || $crep eq 'developer');
my $skip= skip_test();
open (F, ">" . $ENV{'MYSQL_TMP_DIR'} . "/crashrep.inc");
print F "let \$crashrep= $skip;\n";
close F;
EOF        if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }  SET GLOBAL delay_key_write=ALL;
CREATE TABLE t1(a INT,                 b INT,                 PRIMARY KEY(a , b),                 KEY(b)) ENGINE=MyISAM DELAY_KEY_WRITE = 1;
INSERT INTO t1 VALUES (1,2),(2,3),(3,4),(4,5),(5,6);
SET SESSION debug="d,crash_before_flush_keys";
FLUSH TABLE t1;
CHECK TABLE t1;
DROP TABLE t1;
      perl;
sub skip_test {  # Only relevant on Mac OS X  return 0 unless $^O eq 'darwin';
  my $crep= `defaults read com.apple.CrashReporter DialogType`;
  return 0 if $?;
  chomp ($crep);
  $crep= lc $crep;
  return ($crep eq 'basic' || $crep eq 'developer');
my $skip= skip_test();
open (F, ">" . $ENV{'MYSQL_TMP_DIR'} . "/crashrep.inc");
print F "let \$crashrep= $skip;\n";
close F;
EOF        if ($add_wait_counter) {      }      while ($mysql_errno)  # Strangely enough, the server might return "Too many connections"  # while being shutdown, thus 1040 is an "allowed" error  # See BUG#36228    show session status;
  if ($mysql_errno == 1045){      }  if ($mysql_errname == ER_SECURE_TRANSPORT_REQUIRED){      }    if (!$counter)  {      }      if ( $secondary_engine_bootstrap == ON ) {            while ($secondary_engine_status == OFF) {                  if (!$counter) {              }          }        # Wait till the tables get loaded into secondary engine        my $wait_file= "$ENV{MYSQLTEST_VARDIR}/tmp/wait_until_load";
    while (-e $wait_file) {      select(undef, undef, undef, (100 / 1000));
    }    EOF  }  SET GLOBAL delay_key_write=ALL;
CREATE TABLE t1(a INT,                 b INT,                 PRIMARY KEY(a , b),                 KEY(b)) ENGINE=MyISAM DELAY_KEY_WRITE = 1;
INSERT INTO t1 VALUES (1,2),(2,3),(3,4),(4,5),(5,6);
SET SESSION debug="d,crash_before_flush_keys";
FLUSH TABLE t1;
CHECK TABLE t1;
DROP TABLE t1;
