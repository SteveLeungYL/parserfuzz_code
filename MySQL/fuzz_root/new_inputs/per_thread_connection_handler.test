     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   SET @old_debug= @@GLOBAL.debug;
SET @orig_max_connections= @@global.max_connections;
connect (con1, localhost, root,,mysql);
SELECT 1;
connect (con2, localhost, root,,mysql);
SELECT 1;
connect (con3, localhost, root,,mysql);
SELECT 1;
SET GLOBAL debug= '+d,fail_thread_create';
connect (con4, localhost, root,,mysql);
connection default;
SET GLOBAL debug="-d,fail_thread_create";
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL max_connections= 3;
connect (con1, localhost, root,,mysql);
connect (con2, localhost, root,,mysql);
connect (con3, localhost, root,,mysql);
connect (con4, localhost, root,,mysql);
connection default;
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL debug= '+d,simulate_resource_failure';
connect (con1, localhost, root,,mysql);
connection default;
SET GLOBAL debug= '-d,simulate_resource_failure';
SET GLOBAL debug= @old_debug;
SET GLOBAL max_connections= @orig_max_connections;
     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   SET @old_debug= @@GLOBAL.debug;
SET @orig_max_connections= @@global.max_connections;
connect (con1, localhost, root,,mysql);
SELECT 1;
connect (con2, localhost, root,,mysql);
SELECT 1;
connect (con3, localhost, root,,mysql);
SELECT 1;
SET GLOBAL debug= '+d,fail_thread_create';
connect (con4, localhost, root,,mysql);
connection default;
SET GLOBAL debug="-d,fail_thread_create";
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL max_connections= 3;
connect (con1, localhost, root,,mysql);
connect (con2, localhost, root,,mysql);
connect (con3, localhost, root,,mysql);
connect (con4, localhost, root,,mysql);
connection default;
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL debug= '+d,simulate_resource_failure';
connect (con1, localhost, root,,mysql);
connection default;
SET GLOBAL debug= '-d,simulate_resource_failure';
SET GLOBAL debug= @old_debug;
SET GLOBAL max_connections= @orig_max_connections;
     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   SET @old_debug= @@GLOBAL.debug;
SET @orig_max_connections= @@global.max_connections;
connect (con1, localhost, root,,mysql);
SELECT 1;
connect (con2, localhost, root,,mysql);
SELECT 1;
connect (con3, localhost, root,,mysql);
SELECT 1;
SET GLOBAL debug= '+d,fail_thread_create';
connect (con4, localhost, root,,mysql);
connection default;
SET GLOBAL debug="-d,fail_thread_create";
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL max_connections= 3;
connect (con1, localhost, root,,mysql);
connect (con2, localhost, root,,mysql);
connect (con3, localhost, root,,mysql);
connect (con4, localhost, root,,mysql);
connection default;
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL debug= '+d,simulate_resource_failure';
connect (con1, localhost, root,,mysql);
connection default;
SET GLOBAL debug= '-d,simulate_resource_failure';
SET GLOBAL debug= @old_debug;
SET GLOBAL max_connections= @orig_max_connections;
     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   SET @old_debug= @@GLOBAL.debug;
SET @orig_max_connections= @@global.max_connections;
connect (con1, localhost, root,,mysql);
SELECT 1;
connect (con2, localhost, root,,mysql);
SELECT 1;
connect (con3, localhost, root,,mysql);
SELECT 1;
SET GLOBAL debug= '+d,fail_thread_create';
connect (con4, localhost, root,,mysql);
connection default;
SET GLOBAL debug="-d,fail_thread_create";
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL max_connections= 3;
connect (con1, localhost, root,,mysql);
connect (con2, localhost, root,,mysql);
connect (con3, localhost, root,,mysql);
connect (con4, localhost, root,,mysql);
connection default;
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL debug= '+d,simulate_resource_failure';
connect (con1, localhost, root,,mysql);
connection default;
SET GLOBAL debug= '-d,simulate_resource_failure';
SET GLOBAL debug= @old_debug;
SET GLOBAL max_connections= @orig_max_connections;
     let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   SET @old_debug= @@GLOBAL.debug;
SET @orig_max_connections= @@global.max_connections;
connect (con1, localhost, root,,mysql);
SELECT 1;
connect (con2, localhost, root,,mysql);
SELECT 1;
connect (con3, localhost, root,,mysql);
SELECT 1;
SET GLOBAL debug= '+d,fail_thread_create';
connect (con4, localhost, root,,mysql);
connection default;
SET GLOBAL debug="-d,fail_thread_create";
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL max_connections= 3;
connect (con1, localhost, root,,mysql);
connect (con2, localhost, root,,mysql);
connect (con3, localhost, root,,mysql);
connect (con4, localhost, root,,mysql);
connection default;
disconnect con1;
disconnect con2;
disconnect con3;
SET GLOBAL debug= '+d,simulate_resource_failure';
connect (con1, localhost, root,,mysql);
connection default;
SET GLOBAL debug= '-d,simulate_resource_failure';
SET GLOBAL debug= @old_debug;
SET GLOBAL max_connections= @orig_max_connections;
