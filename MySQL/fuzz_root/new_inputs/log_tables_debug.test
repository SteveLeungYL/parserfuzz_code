  SET @old_log_output= @@global.log_output;
SET @old_general_log= @@global.general_log;
SET @old_general_log_file= @@global.general_log_file;
SET @old_slow_query_log= @@global.slow_query_log;
SET @old_slow_query_log_file= @@global.slow_query_log_file;
SET @@global.log_output = 'FILE,TABLE';
SET @@global.general_log = ON;
SET @@global.general_log_file = 'bug45387_general.log';
FLUSH LOGS;
SET @@global.general_log = @old_general_log;
SET @@global.general_log_file = @old_general_log_file;
perl;
  # get the relevant info from the surrounding perl invocation  $datadir= $ENV{'MYSQLD_DATADIR'};
  $conn_id= $ENV{'CONN_ID'};
  # loop through the log file looking for the stmt querying for conn id  open(FILE, "$datadir/bug45387_general.log") or    die("Unable to read log file $datadir/bug45387_general.log: $!\n");
  while(<FILE>) {    if (/\d{4}-\d+-\d+T\d+:\d+:\d+\.\d{6}Z[ \t]+(\d+)[ \t]+Query[ \t]+SELECT CONNECTION_ID/) {      $found= $1;
      break;
    }  }  # print the result  if ($found == $conn_id) {    print "Bug#45387: ID match.\n";
  } else {    print "Bug#45387: Expected ID '$conn_id', found '$found' in log file.\n";
    print "Contents of log file:\n";
    seek(FILE, 0, 0);
    while($line= <FILE>) {      print $line;
    }  }  close(FILE);
EOFSELECT @@session.long_query_time INTO @old_long_query_time;
SET GLOBAL slow_query_log = 1;
TRUNCATE mysql.slow_log;
SET SESSION long_query_time=0;
SET @@session.debug = '+d,slow_log_table_max_rows_examined';
SET @@session.long_query_time = @old_long_query_time;
SET @@session.debug = '-d,slow_log_table_max_rows_examined';
SELECT rows_examined,db,query_time,lock_time,sql_text FROM mysql.slow_log WHERE rows_examined > 0;
SET global log_output = @old_log_output;
SET global general_log = @old_general_log;
SET global general_log_file = @old_general_log_file;
SET global slow_query_log = @old_slow_query_log;
SET global slow_query_log_file = @old_slow_query_log_file;
      let $my_var = `SELECT @old_general_log_file`;
   eval SET @@global.general_log_file = '$my_var';
   let $my_var = `SELECT @old_slow_query_log_file`;
   eval SET @@global.slow_query_log_file = '$my_var';
   TRUNCATE TABLE mysql.general_log;
TRUNCATE TABLE mysql.slow_log;
  SET @old_log_output= @@global.log_output;
SET @old_general_log= @@global.general_log;
SET @old_general_log_file= @@global.general_log_file;
SET @old_slow_query_log= @@global.slow_query_log;
SET @old_slow_query_log_file= @@global.slow_query_log_file;
SET @@global.log_output = 'FILE,TABLE';
SET @@global.general_log = ON;
SET @@global.general_log_file = 'bug45387_general.log';
FLUSH LOGS;
SET @@global.general_log = @old_general_log;
SET @@global.general_log_file = @old_general_log_file;
perl;
  # get the relevant info from the surrounding perl invocation  $datadir= $ENV{'MYSQLD_DATADIR'};
  $conn_id= $ENV{'CONN_ID'};
  # loop through the log file looking for the stmt querying for conn id  open(FILE, "$datadir/bug45387_general.log") or    die("Unable to read log file $datadir/bug45387_general.log: $!\n");
  while(<FILE>) {    if (/\d{4}-\d+-\d+T\d+:\d+:\d+\.\d{6}Z[ \t]+(\d+)[ \t]+Query[ \t]+SELECT CONNECTION_ID/) {      $found= $1;
      break;
    }  }  # print the result  if ($found == $conn_id) {    print "Bug#45387: ID match.\n";
  } else {    print "Bug#45387: Expected ID '$conn_id', found '$found' in log file.\n";
    print "Contents of log file:\n";
    seek(FILE, 0, 0);
    while($line= <FILE>) {      print $line;
    }  }  close(FILE);
EOFSELECT @@session.long_query_time INTO @old_long_query_time;
SET GLOBAL slow_query_log = 1;
TRUNCATE mysql.slow_log;
SET SESSION long_query_time=0;
SET @@session.debug = '+d,slow_log_table_max_rows_examined';
SET @@session.long_query_time = @old_long_query_time;
SET @@session.debug = '-d,slow_log_table_max_rows_examined';
SELECT rows_examined,db,query_time,lock_time,sql_text FROM mysql.slow_log WHERE rows_examined > 0;
SET global log_output = @old_log_output;
SET global general_log = @old_general_log;
SET global general_log_file = @old_general_log_file;
SET global slow_query_log = @old_slow_query_log;
SET global slow_query_log_file = @old_slow_query_log_file;
      let $my_var = `SELECT @old_general_log_file`;
   eval SET @@global.general_log_file = '$my_var';
   let $my_var = `SELECT @old_slow_query_log_file`;
   eval SET @@global.slow_query_log_file = '$my_var';
   TRUNCATE TABLE mysql.general_log;
TRUNCATE TABLE mysql.slow_log;
  SET @old_log_output= @@global.log_output;
SET @old_general_log= @@global.general_log;
SET @old_general_log_file= @@global.general_log_file;
SET @old_slow_query_log= @@global.slow_query_log;
SET @old_slow_query_log_file= @@global.slow_query_log_file;
SET @@global.log_output = 'FILE,TABLE';
SET @@global.general_log = ON;
SET @@global.general_log_file = 'bug45387_general.log';
FLUSH LOGS;
SET @@global.general_log = @old_general_log;
SET @@global.general_log_file = @old_general_log_file;
perl;
  # get the relevant info from the surrounding perl invocation  $datadir= $ENV{'MYSQLD_DATADIR'};
  $conn_id= $ENV{'CONN_ID'};
  # loop through the log file looking for the stmt querying for conn id  open(FILE, "$datadir/bug45387_general.log") or    die("Unable to read log file $datadir/bug45387_general.log: $!\n");
  while(<FILE>) {    if (/\d{4}-\d+-\d+T\d+:\d+:\d+\.\d{6}Z[ \t]+(\d+)[ \t]+Query[ \t]+SELECT CONNECTION_ID/) {      $found= $1;
      break;
    }  }  # print the result  if ($found == $conn_id) {    print "Bug#45387: ID match.\n";
  } else {    print "Bug#45387: Expected ID '$conn_id', found '$found' in log file.\n";
    print "Contents of log file:\n";
    seek(FILE, 0, 0);
    while($line= <FILE>) {      print $line;
    }  }  close(FILE);
EOFSELECT @@session.long_query_time INTO @old_long_query_time;
SET GLOBAL slow_query_log = 1;
TRUNCATE mysql.slow_log;
SET SESSION long_query_time=0;
SET @@session.debug = '+d,slow_log_table_max_rows_examined';
SET @@session.long_query_time = @old_long_query_time;
SET @@session.debug = '-d,slow_log_table_max_rows_examined';
SELECT rows_examined,db,query_time,lock_time,sql_text FROM mysql.slow_log WHERE rows_examined > 0;
SET global log_output = @old_log_output;
SET global general_log = @old_general_log;
SET global general_log_file = @old_general_log_file;
SET global slow_query_log = @old_slow_query_log;
SET global slow_query_log_file = @old_slow_query_log_file;
      let $my_var = `SELECT @old_general_log_file`;
   eval SET @@global.general_log_file = '$my_var';
   let $my_var = `SELECT @old_slow_query_log_file`;
   eval SET @@global.slow_query_log_file = '$my_var';
   TRUNCATE TABLE mysql.general_log;
TRUNCATE TABLE mysql.slow_log;
  SET @old_log_output= @@global.log_output;
SET @old_general_log= @@global.general_log;
SET @old_general_log_file= @@global.general_log_file;
SET @old_slow_query_log= @@global.slow_query_log;
SET @old_slow_query_log_file= @@global.slow_query_log_file;
SET @@global.log_output = 'FILE,TABLE';
SET @@global.general_log = ON;
SET @@global.general_log_file = 'bug45387_general.log';
FLUSH LOGS;
SET @@global.general_log = @old_general_log;
SET @@global.general_log_file = @old_general_log_file;
perl;
  # get the relevant info from the surrounding perl invocation  $datadir= $ENV{'MYSQLD_DATADIR'};
  $conn_id= $ENV{'CONN_ID'};
  # loop through the log file looking for the stmt querying for conn id  open(FILE, "$datadir/bug45387_general.log") or    die("Unable to read log file $datadir/bug45387_general.log: $!\n");
  while(<FILE>) {    if (/\d{4}-\d+-\d+T\d+:\d+:\d+\.\d{6}Z[ \t]+(\d+)[ \t]+Query[ \t]+SELECT CONNECTION_ID/) {      $found= $1;
      break;
    }  }  # print the result  if ($found == $conn_id) {    print "Bug#45387: ID match.\n";
  } else {    print "Bug#45387: Expected ID '$conn_id', found '$found' in log file.\n";
    print "Contents of log file:\n";
    seek(FILE, 0, 0);
    while($line= <FILE>) {      print $line;
    }  }  close(FILE);
EOFSELECT @@session.long_query_time INTO @old_long_query_time;
SET GLOBAL slow_query_log = 1;
TRUNCATE mysql.slow_log;
SET SESSION long_query_time=0;
SET @@session.debug = '+d,slow_log_table_max_rows_examined';
SET @@session.long_query_time = @old_long_query_time;
SET @@session.debug = '-d,slow_log_table_max_rows_examined';
SELECT rows_examined,db,query_time,lock_time,sql_text FROM mysql.slow_log WHERE rows_examined > 0;
SET global log_output = @old_log_output;
SET global general_log = @old_general_log;
SET global general_log_file = @old_general_log_file;
SET global slow_query_log = @old_slow_query_log;
SET global slow_query_log_file = @old_slow_query_log_file;
      let $my_var = `SELECT @old_general_log_file`;
   eval SET @@global.general_log_file = '$my_var';
   let $my_var = `SELECT @old_slow_query_log_file`;
   eval SET @@global.slow_query_log_file = '$my_var';
   TRUNCATE TABLE mysql.general_log;
TRUNCATE TABLE mysql.slow_log;
  SET @old_log_output= @@global.log_output;
SET @old_general_log= @@global.general_log;
SET @old_general_log_file= @@global.general_log_file;
SET @old_slow_query_log= @@global.slow_query_log;
SET @old_slow_query_log_file= @@global.slow_query_log_file;
SET @@global.log_output = 'FILE,TABLE';
SET @@global.general_log = ON;
SET @@global.general_log_file = 'bug45387_general.log';
FLUSH LOGS;
SET @@global.general_log = @old_general_log;
SET @@global.general_log_file = @old_general_log_file;
perl;
  # get the relevant info from the surrounding perl invocation  $datadir= $ENV{'MYSQLD_DATADIR'};
  $conn_id= $ENV{'CONN_ID'};
  # loop through the log file looking for the stmt querying for conn id  open(FILE, "$datadir/bug45387_general.log") or    die("Unable to read log file $datadir/bug45387_general.log: $!\n");
  while(<FILE>) {    if (/\d{4}-\d+-\d+T\d+:\d+:\d+\.\d{6}Z[ \t]+(\d+)[ \t]+Query[ \t]+SELECT CONNECTION_ID/) {      $found= $1;
      break;
    }  }  # print the result  if ($found == $conn_id) {    print "Bug#45387: ID match.\n";
  } else {    print "Bug#45387: Expected ID '$conn_id', found '$found' in log file.\n";
    print "Contents of log file:\n";
    seek(FILE, 0, 0);
    while($line= <FILE>) {      print $line;
    }  }  close(FILE);
EOFSELECT @@session.long_query_time INTO @old_long_query_time;
SET GLOBAL slow_query_log = 1;
TRUNCATE mysql.slow_log;
SET SESSION long_query_time=0;
SET @@session.debug = '+d,slow_log_table_max_rows_examined';
SET @@session.long_query_time = @old_long_query_time;
SET @@session.debug = '-d,slow_log_table_max_rows_examined';
SELECT rows_examined,db,query_time,lock_time,sql_text FROM mysql.slow_log WHERE rows_examined > 0;
SET global log_output = @old_log_output;
SET global general_log = @old_general_log;
SET global general_log_file = @old_general_log_file;
SET global slow_query_log = @old_slow_query_log;
SET global slow_query_log_file = @old_slow_query_log_file;
      let $my_var = `SELECT @old_general_log_file`;
   eval SET @@global.general_log_file = '$my_var';
   let $my_var = `SELECT @old_slow_query_log_file`;
   eval SET @@global.slow_query_log_file = '$my_var';
   TRUNCATE TABLE mysql.general_log;
TRUNCATE TABLE mysql.slow_log;
