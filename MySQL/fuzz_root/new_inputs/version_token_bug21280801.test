   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
     skip Locking service plugin requires the environment variable \$VERSION_TOKEN to be set (normally done by mtr);
eval INSTALL PLUGIN version_tokens SONAME '$VERSION_TOKEN';
eval CREATE FUNCTION version_tokens_set RETURNS STRING SONAME '$VERSION_TOKEN';
eval CREATE FUNCTION version_tokens_show RETURNS STRING SONAME '$VERSION_TOKEN';
eval CREATE FUNCTION version_tokens_edit RETURNS STRING SONAME '$VERSION_TOKEN';
eval CREATE FUNCTION version_tokens_delete RETURNS STRING SONAME '$VERSION_TOKEN';
eval CREATE FUNCTION version_tokens_lock_shared RETURNS INT SONAME '$VERSION_TOKEN';
eval CREATE FUNCTION version_tokens_lock_exclusive RETURNS INT SONAME '$VERSION_TOKEN';
eval CREATE FUNCTION version_tokens_unlock RETURNS INT SONAME '$VERSION_TOKEN';
UPDATE performance_schema.setup_instruments SET enabled = 'NO', timed = 'YES';
UPDATE performance_schema.setup_instruments SET enabled = 'YES'WHERE name IN ('wait/io/table/sql/handler',               'wait/lock/table/sql/handler',               'wait/lock/metadata/sql/mdl');
INSERT INTO performance_schema.setup_objects (object_type, object_schema, object_name, enabled, timed)  VALUES ('TABLE', 'mtr', '%', 'NO', 'NO');
DO version_tokens_set('vt1=11;vt2=22;vt3=33;vt4=44;vt5=55');
SELECT version_tokens_show();
DO version_tokens_lock_exclusive('vt3', 'vt5', 'vt1', 0);
SELECT OBJECT_NAME, LOCK_TYPE, LOCK_DURATION, LOCK_STATUS  FROM performance_schema.metadata_locks  WHERE OBJECT_NAME in ('vt1','vt3','vt5') AND        LOCK_TYPE='EXCLUSIVE'  ORDER BY OBJECT_NAME;
DO version_tokens_lock_exclusive('vt3', 'vt5', 'vt1', 4);
disconnect con2;
DO version_tokens_unlock();
SELECT OBJECT_NAME, LOCK_TYPE, LOCK_DURATION, LOCK_STATUS  FROM performance_schema.metadata_locks  WHERE OBJECT_NAME in ('vt1','vt3','vt5') AND        LOCK_TYPE='EXCLUSIVE'  ORDER BY OBJECT_NAME;
UPDATE performance_schema.setup_instruments SET enabled = 'YES', timed = 'YES';
DELETE FROM performance_schema.setup_objects WHERE object_schema='mtr';
UNINSTALL PLUGIN version_tokens;
DROP FUNCTION version_tokens_set;
DROP FUNCTION version_tokens_show;
DROP FUNCTION version_tokens_edit;
DROP FUNCTION version_tokens_delete;
DROP FUNCTION version_tokens_lock_shared;
DROP FUNCTION version_tokens_lock_exclusive;
DROP FUNCTION version_tokens_unlock;
