    SET @old_debug= @@session.debug;
CREATE TABLE g9(a INT) ENGINE=INNODB;
RIGHT JOIN (SELECT 1 FROM g9) AS d1 ON 1 LEFT JOIN(SELECT 1 FROM g9) AS d2 ON 1;
eval $query;
SET debug= '+d,bug13820776_1';
eval $query;
SET debug= '-d,bug13820776_1';
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
DROP TABLE g9;
SET debug= @old_debug;
CREATE TABLE g1(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g1 VALUES (1,2),(2,3),(4,5);
CREATE TABLE g2(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g2 VALUES (1,2),(2,3),(4,5);
eval $query;
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
SET debug= '+d,bug13822652_1';
eval $query;
SET debug= '-d,bug13822652_1';
eval $query;
SET debug= '+d,bug13822652_2';
eval $query;
SET debug= '-d,bug13822652_2';
DROP TABLE g1,g2;
SET GLOBAL innodb_limit_optimistic_insert_debug = 2;
CREATE TABLE t_innodb(c1 INT NOT NULL PRIMARY KEY,                      c2 INT NOT NULL,                      c3 char(20),                      KEY c3_idx(c3))ENGINE=INNODB;
INSERT INTO t_innodb VALUES (1, 1, 'a'), (2,2,'a'), (3,3,'a');
ANALYZE TABLE t_innodb;
SET debug= '+d,bug28079850';
SELECT COUNT(*) FROM t_innodb;
SELECT COUNT(*) FROM performance_schema.table_handles;
SET debug= '-d,bug28079850';
DROP TABLE t_innodb;
SET debug= @old_debug;
connect (con1, localhost, root,,);
SET DEBUG_SYNC='before_command_dispatch SIGNAL kill_query WAIT_FOR continue';
connection default;
SET DEBUG_SYNC='now WAIT_FOR kill_query';
SET DEBUG_SYNC='now SIGNAL continue';
connection con1;
connection default;
SET DEBUG_SYNC='RESET';
disconnect con1;
SET GLOBAL innodb_limit_optimistic_insert_debug = 0;
    SET @old_debug= @@session.debug;
CREATE TABLE g9(a INT) ENGINE=INNODB;
RIGHT JOIN (SELECT 1 FROM g9) AS d1 ON 1 LEFT JOIN(SELECT 1 FROM g9) AS d2 ON 1;
eval $query;
SET debug= '+d,bug13820776_1';
eval $query;
SET debug= '-d,bug13820776_1';
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
DROP TABLE g9;
SET debug= @old_debug;
CREATE TABLE g1(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g1 VALUES (1,2),(2,3),(4,5);
CREATE TABLE g2(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g2 VALUES (1,2),(2,3),(4,5);
eval $query;
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
SET debug= '+d,bug13822652_1';
eval $query;
SET debug= '-d,bug13822652_1';
eval $query;
SET debug= '+d,bug13822652_2';
eval $query;
SET debug= '-d,bug13822652_2';
DROP TABLE g1,g2;
SET GLOBAL innodb_limit_optimistic_insert_debug = 2;
CREATE TABLE t_innodb(c1 INT NOT NULL PRIMARY KEY,                      c2 INT NOT NULL,                      c3 char(20),                      KEY c3_idx(c3))ENGINE=INNODB;
INSERT INTO t_innodb VALUES (1, 1, 'a'), (2,2,'a'), (3,3,'a');
ANALYZE TABLE t_innodb;
SET debug= '+d,bug28079850';
SELECT COUNT(*) FROM t_innodb;
SELECT COUNT(*) FROM performance_schema.table_handles;
SET debug= '-d,bug28079850';
DROP TABLE t_innodb;
SET debug= @old_debug;
connect (con1, localhost, root,,);
SET DEBUG_SYNC='before_command_dispatch SIGNAL kill_query WAIT_FOR continue';
connection default;
SET DEBUG_SYNC='now WAIT_FOR kill_query';
SET DEBUG_SYNC='now SIGNAL continue';
connection con1;
connection default;
SET DEBUG_SYNC='RESET';
disconnect con1;
SET GLOBAL innodb_limit_optimistic_insert_debug = 0;
    SET @old_debug= @@session.debug;
CREATE TABLE g9(a INT) ENGINE=INNODB;
RIGHT JOIN (SELECT 1 FROM g9) AS d1 ON 1 LEFT JOIN(SELECT 1 FROM g9) AS d2 ON 1;
eval $query;
SET debug= '+d,bug13820776_1';
eval $query;
SET debug= '-d,bug13820776_1';
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
DROP TABLE g9;
SET debug= @old_debug;
CREATE TABLE g1(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g1 VALUES (1,2),(2,3),(4,5);
CREATE TABLE g2(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g2 VALUES (1,2),(2,3),(4,5);
eval $query;
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
SET debug= '+d,bug13822652_1';
eval $query;
SET debug= '-d,bug13822652_1';
eval $query;
SET debug= '+d,bug13822652_2';
eval $query;
SET debug= '-d,bug13822652_2';
DROP TABLE g1,g2;
SET GLOBAL innodb_limit_optimistic_insert_debug = 2;
CREATE TABLE t_innodb(c1 INT NOT NULL PRIMARY KEY,                      c2 INT NOT NULL,                      c3 char(20),                      KEY c3_idx(c3))ENGINE=INNODB;
INSERT INTO t_innodb VALUES (1, 1, 'a'), (2,2,'a'), (3,3,'a');
ANALYZE TABLE t_innodb;
SET debug= '+d,bug28079850';
SELECT COUNT(*) FROM t_innodb;
SELECT COUNT(*) FROM performance_schema.table_handles;
SET debug= '-d,bug28079850';
DROP TABLE t_innodb;
SET debug= @old_debug;
connect (con1, localhost, root,,);
SET DEBUG_SYNC='before_command_dispatch SIGNAL kill_query WAIT_FOR continue';
connection default;
SET DEBUG_SYNC='now WAIT_FOR kill_query';
SET DEBUG_SYNC='now SIGNAL continue';
connection con1;
connection default;
SET DEBUG_SYNC='RESET';
disconnect con1;
SET GLOBAL innodb_limit_optimistic_insert_debug = 0;
    SET @old_debug= @@session.debug;
CREATE TABLE g9(a INT) ENGINE=INNODB;
RIGHT JOIN (SELECT 1 FROM g9) AS d1 ON 1 LEFT JOIN(SELECT 1 FROM g9) AS d2 ON 1;
eval $query;
SET debug= '+d,bug13820776_1';
eval $query;
SET debug= '-d,bug13820776_1';
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
DROP TABLE g9;
SET debug= @old_debug;
CREATE TABLE g1(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g1 VALUES (1,2),(2,3),(4,5);
CREATE TABLE g2(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g2 VALUES (1,2),(2,3),(4,5);
eval $query;
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
SET debug= '+d,bug13822652_1';
eval $query;
SET debug= '-d,bug13822652_1';
eval $query;
SET debug= '+d,bug13822652_2';
eval $query;
SET debug= '-d,bug13822652_2';
DROP TABLE g1,g2;
SET GLOBAL innodb_limit_optimistic_insert_debug = 2;
CREATE TABLE t_innodb(c1 INT NOT NULL PRIMARY KEY,                      c2 INT NOT NULL,                      c3 char(20),                      KEY c3_idx(c3))ENGINE=INNODB;
INSERT INTO t_innodb VALUES (1, 1, 'a'), (2,2,'a'), (3,3,'a');
ANALYZE TABLE t_innodb;
SET debug= '+d,bug28079850';
SELECT COUNT(*) FROM t_innodb;
SELECT COUNT(*) FROM performance_schema.table_handles;
SET debug= '-d,bug28079850';
DROP TABLE t_innodb;
SET debug= @old_debug;
connect (con1, localhost, root,,);
SET DEBUG_SYNC='before_command_dispatch SIGNAL kill_query WAIT_FOR continue';
connection default;
SET DEBUG_SYNC='now WAIT_FOR kill_query';
SET DEBUG_SYNC='now SIGNAL continue';
connection con1;
connection default;
SET DEBUG_SYNC='RESET';
disconnect con1;
SET GLOBAL innodb_limit_optimistic_insert_debug = 0;
    SET @old_debug= @@session.debug;
CREATE TABLE g9(a INT) ENGINE=INNODB;
RIGHT JOIN (SELECT 1 FROM g9) AS d1 ON 1 LEFT JOIN(SELECT 1 FROM g9) AS d2 ON 1;
eval $query;
SET debug= '+d,bug13820776_1';
eval $query;
SET debug= '-d,bug13820776_1';
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
DROP TABLE g9;
SET debug= @old_debug;
CREATE TABLE g1(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g1 VALUES (1,2),(2,3),(4,5);
CREATE TABLE g2(a INT PRIMARY KEY, b INT) ENGINE=INNODB;
INSERT INTO g2 VALUES (1,2),(2,3),(4,5);
eval $query;
SET debug= '+d,bug13820776_2';
eval $query;
SET debug= '-d,bug13820776_2';
SET debug= '+d,bug13822652_1';
eval $query;
SET debug= '-d,bug13822652_1';
eval $query;
SET debug= '+d,bug13822652_2';
eval $query;
SET debug= '-d,bug13822652_2';
DROP TABLE g1,g2;
SET GLOBAL innodb_limit_optimistic_insert_debug = 2;
CREATE TABLE t_innodb(c1 INT NOT NULL PRIMARY KEY,                      c2 INT NOT NULL,                      c3 char(20),                      KEY c3_idx(c3))ENGINE=INNODB;
INSERT INTO t_innodb VALUES (1, 1, 'a'), (2,2,'a'), (3,3,'a');
ANALYZE TABLE t_innodb;
SET debug= '+d,bug28079850';
SELECT COUNT(*) FROM t_innodb;
SELECT COUNT(*) FROM performance_schema.table_handles;
SET debug= '-d,bug28079850';
DROP TABLE t_innodb;
SET debug= @old_debug;
connect (con1, localhost, root,,);
SET DEBUG_SYNC='before_command_dispatch SIGNAL kill_query WAIT_FOR continue';
connection default;
SET DEBUG_SYNC='now WAIT_FOR kill_query';
SET DEBUG_SYNC='now SIGNAL continue';
connection con1;
connection default;
SET DEBUG_SYNC='RESET';
disconnect con1;
SET GLOBAL innodb_limit_optimistic_insert_debug = 0;
