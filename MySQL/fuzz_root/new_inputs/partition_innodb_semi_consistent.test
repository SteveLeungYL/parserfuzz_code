  connect (a,localhost,root,,);
connect (b,localhost,root,,);
connection a;
set binlog_format=mixed;
set session transaction isolation level repeatable read;
create table t1(a int not null)engine=innodbDEFAULT CHARSET=latin1PARTITION BY RANGE(a)(PARTITION p0 VALUES LESS THAN (20), PARTITION p1 VALUES LESS THAN MAXVALUE);
insert into t1 values (1),(2),(3),(4),(5),(6),(7);
set autocommit=0;
select * from t1 where a=3 lock in share mode;
connection b;
set binlog_format=mixed;
set session transaction isolation level repeatable read;
set autocommit=0;
update t1 set a=10 where a=5;
commit;
connection a;
commit;
connection b;
set session transaction isolation level read committed;
update t1 set a=10 where a=5;
connection a;
select * from t1 where a=2 for update;
select * from t1 where a=2 limit 1 for update;
connection b;
update t1 set a=11 where a=6;
update t1 set a=12 where a=2;
update t1 set a=13 where a=1;
connection a;
commit;
connection b;
update t1 set a=14 where a=1;
commit;
connection a;
select * from t1;
drop table t1;
connection default;
disconnect a;
disconnect b;
connect (con1,localhost,root,,);
connect (con2,localhost,root,,);
SET SESSION AUTOCOMMIT = 0;
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
set binlog_format=mixed;
connection con1;
evalCREATE TABLE t1 (a INT PRIMARY KEY, b VARCHAR(256))ENGINE = InnoDBPARTITION BY RANGE (a)(PARTITION p0 VALUES LESS THAN (300), PARTITION p1 VALUES LESS THAN MAXVALUE);
INSERT INTO t1 VALUES (1,2);
BEGIN;
UPDATE t1 SET b = 12 WHERE a = 1;
SELECT * FROM t1;
connection con2;
UPDATE t1 SET b = 21 WHERE a = 1;
ROLLBACK;
connection con1;
SELECT * FROM t1;
ROLLBACK;
CREATE TABLE t2 (a INT);
TRUNCATE t1;
INSERT INTO t1 VALUES (1,'init');
DELIMITER |;
CREATE PROCEDURE p1()BEGIN  UPDATE t1 SET b = CONCAT(b, '+con2')  WHERE a = 1;
  INSERT INTO t2 VALUES ();
END|DELIMITER ;|BEGIN;
UPDATE t1 SET b = CONCAT(b, '+con1') WHERE a = 1;
SELECT * FROM t1;
connection con2;
connection con1;
SELECT * FROM t1;
COMMIT;
while ($bug31310)  let $bug31310= `SELECT 1 - COUNT(*) FROM t2`;
SELECT * FROM t1;
connection con2;
SELECT * FROM t1;
COMMIT;
connection con1;
TRUNCATE t1;
DELETE FROM t2;
INSERT INTO t1 VALUES (1,'init');
BEGIN;
UPDATE t1 SET a = 2, b = CONCAT(b, '+con1') WHERE a = 1;
SELECT * FROM t1;
connection con2;
connection con1;
SELECT * FROM t1;
COMMIT;
while ($bug31310)  let $bug31310= `SELECT 1 - COUNT(*) FROM t2`;
SELECT * FROM t1;
connection con2;
reap;
SELECT * FROM t1;
connection default;
disconnect con1;
disconnect con2;
DROP PROCEDURE p1;
DROP TABLE t1, t2;
