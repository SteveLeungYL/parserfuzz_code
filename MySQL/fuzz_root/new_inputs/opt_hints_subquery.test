CREATE TABLE t1 (a INTEGER NOT NULL, b INT, PRIMARY KEY (a));
CREATE TABLE t2 (a INTEGER NOT NULL, KEY (a));
CREATE TABLE t3 (a INTEGER NOT NULL, b INT, KEY (a));
INSERT INTO t1 VALUES (1,10), (2,20), (3,30),  (4,40);
INSERT INTO t2 VALUES (2), (3), (4), (5);
INSERT INTO t3 VALUES (10,3), (20,4), (30,5);
ANALYZE TABLE t1, t2, t3;
EXPLAINSELECT * FROM t2 WHERE t2.a IN (SELECT a FROM t1);
EXPLAINSELECT * FROM t2 WHERE t2.a IN (SELECT /*+ NO_SEMIJOIN() */ a FROM t1);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ a FROM t1);
EXPLAINSELECT * FROM t3WHERE t3.a IN (SELECT a FROM t1 tx)  AND t3.b IN (SELECT a FROM t1 ty);
EXPLAINSELECT * FROM t3WHERE t3.a IN (SELECT /*+ NO_SEMIJOIN() */ a FROM t1 tx)  AND t3.b IN (SELECT a FROM t1 ty);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(`subq1`) */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty);
EXPLAINSELECT * FROM t3WHERE t3.a IN (SELECT a FROM t1 tx)  AND t3.b IN (SELECT /*+ NO_SEMIJOIN() */ a FROM t1 ty);
EXPLAINSELECT /*+ NO_SEMIJOIN(@`subq2`) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty);
EXPLAINSELECT * FROM t3WHERE t3.a IN (SELECT /*+ NO_SEMIJOIN() */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ NO_SEMIJOIN() */ a FROM t1 ty);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1) NO_SEMIJOIN(@subq2) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty);
EXPLAINSELECT * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq2) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
EXPLAINSELECT /*+  NO_SEMIJOIN(@subq1) NO_SEMIJOIN(@subq2) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
EXPLAINSELECT /*+ SEMIJOIN(@subq) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ min(a) FROM t1 group by a);
EXPLAINSELECT * FROM t2 WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 LOOSESCAN) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, LOOSESCAN) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, LOOSESCAN, MATERIALIZATION) */ *FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, LOOSESCAN, MATERIALIZATION,           DUPSWEEDOUT) */ *FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION, DUPSWEEDOUT) */ *FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, MATERIALIZATION, DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, FIRSTMATCH, MATERIALIZATION,           DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION, DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION, DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, DUPSWEEDOUT) */ * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, MATERIALIZATION) */ * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
EXPLAINSELECT * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN) SEMIJOIN(@subq2 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH) SEMIJOIN(@subq2 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN) SEMIJOIN(@subq2 LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH) SEMIJOIN(@subq2 LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH, LOOSESCAN)           SEMIJOIN(@subq2 MATERIALIZATION, DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION, DUPSWEEDOUT)           SEMIJOIN(@subq2 FIRSTMATCH, LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION, FIRSTMATCH)           SEMIJOIN(@subq2 LOOSESCAN, DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 LOOSESCAN)           NO_SEMIJOIN(@subq2 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 LOOSESCAN, FIRSTMATCH)           NO_SEMIJOIN(@subq2 FIRSTMATCH, LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 LOOSESCAN, FIRSTMATCH, DUPSWEEDOUT)           NO_SEMIJOIN(@subq2 FIRSTMATCH, LOOSESCAN, DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION)           SEMIJOIN(@subq2 MATERIALIZATION) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION)           SEMIJOIN(@subq2 DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION)           SEMIJOIN(@subq2 LOOSESCAN, FIRSTMATCH, DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION, DUPSWEEDOUT) */ *FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, LOOSESCAN, MATERIALIZATION,           DUPSWEEDOUT) */ *FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH, DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH, LOOSESCAN, DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION, LOOSESCAN,           DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION, LOOSESCAN, DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq2 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq2 MATERIALIZATION) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1) NO_SEMIJOIN(@subq2 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1)           NO_SEMIJOIN(@subq2 FIRSTMATCH, MATERIALIZATION) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1)           NO_SEMIJOIN(@subq2 FIRSTMATCH, MATERIALIZATION, DUPSWEEDOUT) */ *FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1)           SEMIJOIN(@subq2 MATERIALIZATION, DUPSWEEDOUT, LOOSESCAN) */ *FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1) SEMIJOIN(@subq2 LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq2) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH) NO_SEMIJOIN(@subq2) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION)       	   NO_SEMIJOIN(@subq2) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION, DUPSWEEDOUT)       	   NO_SEMIJOIN(@subq2) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION, DUPSWEEDOUT, LOOSESCAN)       	   NO_SEMIJOIN(@subq2) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ SEMIJOIN(@subq1 DUPSWEEDOUT) NO_SEMIJOIN(@subq2) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1) NO_SEMIJOIN(@subq2) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2));
PREPARE stmt1 FROM "EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, LOOSESCAN)           NO_SEMIJOIN(@subq2 FIRSTMATCH, LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2)";
EXECUTE stmt1;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
PREPARE stmt1 FROM "EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1) SEMIJOIN(@subq2 LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3               WHERE t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2))";
EXECUTE stmt1;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
SET optimizer_switch = default;
SET optimizer_switch = 'semijoin=off';
EXPLAINSELECT * FROM t2 WHERE t2.a IN (SELECT a FROM t1);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ a FROM t1);
EXPLAINSELECT /*+ SEMIJOIN(@subq) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ a FROM t1);
EXPLAINSELECT /*+ SEMIJOIN(@subq FIRSTMATCH) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ a FROM t1);
EXPLAINSELECT * FROM t3WHERE t3.a IN (SELECT a FROM t1 tx)  AND t3.b IN (SELECT a FROM t1 ty);
EXPLAINSELECT /*+ SEMIJOIN(@subq1) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty);
EXPLAINSELECT /*+ SEMIJOIN(@subq2) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty);
EXPLAINSELECT /*+ SEMIJOIN(@subq1) SEMIJOIN(@subq2) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty);
EXPLAINSELECT * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
EXPLAINSELECT /*+ SEMIJOIN(@subq1) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
EXPLAINSELECT /*+ SEMIJOIN(@subq2) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
EXPLAINSELECT /*+ SEMIJOIN(@subq1) SEMIJOIN(@subq2) */ * FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
SET optimizer_switch='semijoin=on';
SET optimizer_switch='loosescan=off';
EXPLAINSELECT * FROM t2 WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 LOOSESCAN) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION) */ *FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, MATERIALIZATION, DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, FIRSTMATCH, MATERIALIZATION,           DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
SET optimizer_switch='firstmatch=off';
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION, DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 MATERIALIZATION, DUPSWEEDOUT) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, DUPSWEEDOUT) */ * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, FIRSTMATCH) */ * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
EXPLAINSELECT * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, FIRSTMATCH)       	   SEMIJOIN(@subq2 LOOSESCAN, FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH) SEMIJOIN(@subq2 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH) SEMIJOIN(@subq2 LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH, LOOSESCAN)           SEMIJOIN(@subq2 MATERIALIZATION, DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 DUPSWEEDOUT)           NO_SEMIJOIN(@subq2 DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 MATERIALIZATION)           SEMIJOIN(@subq2 MATERIALIZATION) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq2 DUPSWEEDOUT) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
SET optimizer_switch='firstmatch=on,loosescan=on,materialization=on,duplicateweedout=off';
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 LOOSESCAN, FIRSTMATCH, MATERIALIZATION) */ *FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH) */ * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, MATERIALIZATION) */ * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
SET optimizer_switch='firstmatch=off,loosescan=off,materialization=off,duplicateweedout=off';
EXPLAINSELECT * FROM t2 WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 LOOSESCAN, DUPSWEEDOUT) */ *FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 FIRSTMATCH, MATERIALIZATION) */ *FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, MATERIALIZATION) */ * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN, FIRSTMATCH) */ * FROM t1WHERE t1.b IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3 WHERE t3.b = t1.a);
SET optimizer_switch = default;
PREPARE stmt1 FROM "EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 FIRSTMATCH, LOOSESCAN)           NO_SEMIJOIN(@subq2 FIRSTMATCH, LOOSESCAN) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2)";
EXECUTE stmt1;
SET optimizer_switch = 'duplicateweedout=off';
EXECUTE stmt1;
SET optimizer_switch = 'duplicateweedout=on';
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
SET optimizer_switch = default;
EXPLAINSELECT * FROM t2WHERE t2.a IN (SELECT /*+ NO_SEMIJOIN() SEMIJOIN() */ a FROM t1);
EXPLAINSELECT * FROM t2WHERE t2.a IN (SELECT /*+ SEMIJOIN() NO_SEMIJOIN() */ a FROM t1);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) SEMIJOIN() */ a FROM t1);
EXPLAINSELECT /*+ SEMIJOIN(@subq) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) NO_SEMIJOIN() */ a FROM t1);
EXPLAINSELECT /*+ SEMIJOIN(@subq) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) SEMIJOIN() */ a FROM t1);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) NO_SEMIJOIN() */ a FROM t1);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN) SEMIJOIN(@subq2 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) NO_SEMIJOIN() */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) SEMIJOIN(LOOSESCAN) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN) SEMIJOIN(@subq2 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) NO_SEMIJOIN(LOOSESCAN) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) SEMIJOIN(LOOSESCAN) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN) SEMIJOIN(@subq1 FIRSTMATCH) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 LOOSESCAN) NO_SEMIJOIN(@subq1 LOOSESCAN) */ *FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ NO_SEMIJOIN(@subq1 LOOSESCAN) NO_SEMIJOIN(@subq1 FIRSTMATCH) */ *FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT /*+ SEMIJOIN(@subq1 INTOEXISTS) NO_SEMIJOIN(@subq2 INTOEXISTS) */ *FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2);
EXPLAINSELECT * FROM t2 WHERE t2.a IN (SELECT /*+ SUBQUERY(INTOEXISTS) */ a FROM t1);
EXPLAINSELECT /*+ SUBQUERY(@subq MATERIALIZATION) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ a FROM t1);
EXPLAINSELECT /*+ SUBQUERY(@subq1 INTOEXISTS) SUBQUERY(@subq2 MATERIALIZATION) */ *FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty);
EXPLAINSELECT /*+ SUBQUERY(@subq1 INTOEXISTS) SUBQUERY(@subq2 MATERIALIZATION) */ *FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
EXPLAINSELECT /*+ SUBQUERY(@subq1 MATERIALIZATION) SUBQUERY(@subq2 INTOEXISTS) */ *FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx               WHERE tx.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty));
EXPLAINSELECT * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ min(a) FROM t1 group by a);
EXPLAINSELECT /*+ SUBQUERY(@subq INTOEXISTS) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ min(a) FROM t1 group by a);
EXPLAINSELECT a, a IN (SELECT a FROM t1) FROM t2;
EXPLAINSELECT a, a IN (SELECT /*+ SUBQUERY(MATERIALIZATION) */ a FROM t1) FROM t2;
EXPLAINSELECT /*+ SUBQUERY(@subq MATERIALIZATION) */ a,       a IN (SELECT /*+ QB_NAME(subq) */ a FROM t1) FROM t2;
EXPLAINSELECT * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ concat(sum(b),"") FROM t1 group by a);
EXPLAINSELECT /*+ SUBQUERY(@subq MATERIALIZATION) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ concat(sum(b),"") FROM t1 group by a);
PREPARE stmt1 FROM "EXPLAINSELECT /*+ SUBQUERY(@subq1 MATERIALIZATION)           SUBQUERY(@subq2 INTOEXISTS) */ * FROM t1WHERE t1.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t3)  AND t1.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t2)";
EXECUTE stmt1;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
SET optimizer_switch='materialization=off';
EXPLAINSELECT * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ min(a) FROM t1 group by a);
EXPLAINSELECT /*+ SUBQUERY(@subq MATERIALIZATION) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) */ min(a) FROM t1 group by a);
SET optimizer_switch='materialization=on,subquery_materialization_cost_based=off';
EXPLAINSELECT a, a IN (SELECT a FROM t1) FROM t2;
EXPLAINSELECT /*+ SUBQUERY(@subq INTOEXISTS) */ a,       a IN (SELECT /*+ QB_NAME(subq) */ a FROM t1) FROM t2;
EXPLAINSELECT /*+ SUBQUERY(@subq1 MATERIALIZATION, INTOEXISTS)       SUBQUERY(@subq2 MATERIALIZATION, INTOEXISTS) */ *FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty);
EXPLAINSELECT /*+ SUBQUERY(@subq1 FIRSTMATCH) SUBQUERY(@subq2 LOOSESCAN) */ *FROM t3WHERE t3.a IN (SELECT /*+ QB_NAME(subq1) */ a FROM t1 tx)  AND t3.b IN (SELECT /*+ QB_NAME(subq2) */ a FROM t1 ty);
SET optimizer_switch= default;
EXPLAINSELECT * FROM t2WHERE t2.a IN (SELECT /*+ SUBQUERY(MATERIALIZATION) SUBQUERY(INTOEXISTS) */ aFROM t1);
EXPLAINSELECT * FROM t2WHERE t2.a IN (SELECT /*+ SUBQUERY(INTOEXISTS) SUBQUERY(MATERIALIZATION) */ aFROM t1);
EXPLAINSELECT /*+ SUBQUERY(@subq MATERIALIZATION) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) SUBQUERY(INTOEXISTS) */ a FROM t1);
EXPLAINSELECT /*+ SUBQUERY(@subq INTOEXISTS) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) SUBQUERY(MATERIALIZATION) */ a FROM t1);
EXPLAINSELECT * FROM t2WHERE t2.a IN (SELECT /*+ SUBQUERY(INTOEXISTS) SEMIJOIN() */ a FROM t1);
EXPLAINSELECT * FROM t2WHERE t2.a IN (SELECT /*+ NO_SEMIJOIN() SUBQUERY(MATERIALIZATION) */ a FROM t1);
EXPLAINSELECT /*+ SUBQUERY(@subq MATERIALIZATION) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) SEMIJOIN() */ a FROM t1);
EXPLAINSELECT /*+ SUBQUERY(@subq INTOEXISTS) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) NO_SEMIJOIN() */ a FROM t1);
EXPLAINSELECT /*+ SEMIJOIN(@subq FIRSTMATCH) */ * FROM t2WHERE t2.a IN (SELECT /*+ QB_NAME(subq) SUBQUERY(@subq INTOEXISTS) */ a FROM t1);
drop table t1, t2, t3;
