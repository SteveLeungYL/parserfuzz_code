   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   CREATE USER foo@localhost IDENTIFIED BY 'foo';
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 4 PASSWORD_LOCK_TIME 6;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost IDENTIFIED BY 'foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
FLUSH PRIVILEGES;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcont,localhost,foo,foo,test);
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
CREATE USER bar@localhost IDENTIFIED BY 'bar';
disable_query_log;
connect(errcon,localhost,bar,,test);
enable_query_log;
connection default;
DROP USER foo@localhost;
DROP USER bar@localhost;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SHOW CREATE USER foo@localhost;
CREATE USER failed_login_attempts@localhost FAILED_LOGIN_ATTEMPTS 2;
SHOW CREATE USER failed_login_attempts@localhost;
CREATE USER password_lock_time@localhost PASSWORD_LOCK_TIME 3;
SHOW CREATE USER password_lock_time@localhost;
DROP USER foo@localhost;
remove_file $file;
DROP USER foo@localhost, failed_login_attempts@localhost, password_lock_time@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
connect(con1,localhost,foo,foo,test);
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": 1}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user,host,user_attributes FROM mysql.user WHERE user='foo';
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": -2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": -2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": "2", "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": "2"}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes=NULL WHERE user='foo';
FLUSH PRIVILEGES;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3 ACCOUNT LOCK;
disable_query_log;
connect(errcon,localhost,foo,foo,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL check_proxy_users = ON;
SET GLOBAL mysql_native_password_proxy_users = ON;
CREATE USER proxied_to_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
CREATE USER proxy_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
GRANT PROXY ON proxied_to_user@localhost TO proxy_user@localhost;
connect(con1,localhost,proxy_user,,test);
SELECT USER(), CURRENT_USER(), @@session.proxy_user;
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxied_to_user,proxied_to_user,test);
enable_query_log;
REVOKE PROXY ON proxied_to_user@localhost FROM proxy_user@localhost;
DROP USER proxied_to_user@localhost, proxy_user@localhost;
SET GLOBAL check_proxy_users = DEFAULT;
SET GLOBAL mysql_native_password_proxy_users = DEFAULT;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 2;
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL partial_revokes=1;
CREATE USER u1 identified by 'pwd';
GRANT CREATE ON *.* TO u1;
REVOKE CREATE ON mysql.* FROM u1;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 0 PASSWORD_LOCK_TIME 0;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
DROP USER u1;
SET GLOBAL partial_revokes=DEFAULT;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS -1;
CREATE USER goo@localhost FAILED_LOGIN_ATTEMPTS 32768;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 32767;
DROP USER foo@localhost;
CREATE USER foo@localhost PASSWORD_LOCK_TIME -1;
CREATE USER goo@localhost PASSWORD_LOCK_TIME 32768;
CREATE USER foo@localhost PASSWORD_LOCK_TIME 32767;
DROP USER foo@localhost;
CREATE USER ''@localhost IDENTIFIED BY 'pwd' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,non-existent,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,non-existent2,,test);
enable_query_log;
DROP USER ''@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' PASSWORD_LOCK_TIME 3 FAILED_LOGIN_ATTEMPTS 2;
ALTER USER foo@localhost ATTRIBUTE "{ \"test\": \"account locking\" }";
ALTER USER foo@localhost COMMENT "This is a test account for verifying that password locking and user attributes won't interfer with one and another.";
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   CREATE USER foo@localhost IDENTIFIED BY 'foo';
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 4 PASSWORD_LOCK_TIME 6;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost IDENTIFIED BY 'foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
FLUSH PRIVILEGES;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcont,localhost,foo,foo,test);
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
CREATE USER bar@localhost IDENTIFIED BY 'bar';
disable_query_log;
connect(errcon,localhost,bar,,test);
enable_query_log;
connection default;
DROP USER foo@localhost;
DROP USER bar@localhost;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SHOW CREATE USER foo@localhost;
CREATE USER failed_login_attempts@localhost FAILED_LOGIN_ATTEMPTS 2;
SHOW CREATE USER failed_login_attempts@localhost;
CREATE USER password_lock_time@localhost PASSWORD_LOCK_TIME 3;
SHOW CREATE USER password_lock_time@localhost;
DROP USER foo@localhost;
remove_file $file;
DROP USER foo@localhost, failed_login_attempts@localhost, password_lock_time@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
connect(con1,localhost,foo,foo,test);
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": 1}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user,host,user_attributes FROM mysql.user WHERE user='foo';
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": -2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": -2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": "2", "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": "2"}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes=NULL WHERE user='foo';
FLUSH PRIVILEGES;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3 ACCOUNT LOCK;
disable_query_log;
connect(errcon,localhost,foo,foo,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL check_proxy_users = ON;
SET GLOBAL mysql_native_password_proxy_users = ON;
CREATE USER proxied_to_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
CREATE USER proxy_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
GRANT PROXY ON proxied_to_user@localhost TO proxy_user@localhost;
connect(con1,localhost,proxy_user,,test);
SELECT USER(), CURRENT_USER(), @@session.proxy_user;
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxied_to_user,proxied_to_user,test);
enable_query_log;
REVOKE PROXY ON proxied_to_user@localhost FROM proxy_user@localhost;
DROP USER proxied_to_user@localhost, proxy_user@localhost;
SET GLOBAL check_proxy_users = DEFAULT;
SET GLOBAL mysql_native_password_proxy_users = DEFAULT;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 2;
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL partial_revokes=1;
CREATE USER u1 identified by 'pwd';
GRANT CREATE ON *.* TO u1;
REVOKE CREATE ON mysql.* FROM u1;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 0 PASSWORD_LOCK_TIME 0;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
DROP USER u1;
SET GLOBAL partial_revokes=DEFAULT;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS -1;
CREATE USER goo@localhost FAILED_LOGIN_ATTEMPTS 32768;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 32767;
DROP USER foo@localhost;
CREATE USER foo@localhost PASSWORD_LOCK_TIME -1;
CREATE USER goo@localhost PASSWORD_LOCK_TIME 32768;
CREATE USER foo@localhost PASSWORD_LOCK_TIME 32767;
DROP USER foo@localhost;
CREATE USER ''@localhost IDENTIFIED BY 'pwd' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,non-existent,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,non-existent2,,test);
enable_query_log;
DROP USER ''@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' PASSWORD_LOCK_TIME 3 FAILED_LOGIN_ATTEMPTS 2;
ALTER USER foo@localhost ATTRIBUTE "{ \"test\": \"account locking\" }";
ALTER USER foo@localhost COMMENT "This is a test account for verifying that password locking and user attributes won't interfer with one and another.";
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   CREATE USER foo@localhost IDENTIFIED BY 'foo';
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 4 PASSWORD_LOCK_TIME 6;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost IDENTIFIED BY 'foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
FLUSH PRIVILEGES;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcont,localhost,foo,foo,test);
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
CREATE USER bar@localhost IDENTIFIED BY 'bar';
disable_query_log;
connect(errcon,localhost,bar,,test);
enable_query_log;
connection default;
DROP USER foo@localhost;
DROP USER bar@localhost;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SHOW CREATE USER foo@localhost;
CREATE USER failed_login_attempts@localhost FAILED_LOGIN_ATTEMPTS 2;
SHOW CREATE USER failed_login_attempts@localhost;
CREATE USER password_lock_time@localhost PASSWORD_LOCK_TIME 3;
SHOW CREATE USER password_lock_time@localhost;
DROP USER foo@localhost;
remove_file $file;
DROP USER foo@localhost, failed_login_attempts@localhost, password_lock_time@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
connect(con1,localhost,foo,foo,test);
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": 1}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user,host,user_attributes FROM mysql.user WHERE user='foo';
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": -2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": -2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": "2", "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": "2"}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes=NULL WHERE user='foo';
FLUSH PRIVILEGES;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3 ACCOUNT LOCK;
disable_query_log;
connect(errcon,localhost,foo,foo,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL check_proxy_users = ON;
SET GLOBAL mysql_native_password_proxy_users = ON;
CREATE USER proxied_to_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
CREATE USER proxy_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
GRANT PROXY ON proxied_to_user@localhost TO proxy_user@localhost;
connect(con1,localhost,proxy_user,,test);
SELECT USER(), CURRENT_USER(), @@session.proxy_user;
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxied_to_user,proxied_to_user,test);
enable_query_log;
REVOKE PROXY ON proxied_to_user@localhost FROM proxy_user@localhost;
DROP USER proxied_to_user@localhost, proxy_user@localhost;
SET GLOBAL check_proxy_users = DEFAULT;
SET GLOBAL mysql_native_password_proxy_users = DEFAULT;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 2;
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL partial_revokes=1;
CREATE USER u1 identified by 'pwd';
GRANT CREATE ON *.* TO u1;
REVOKE CREATE ON mysql.* FROM u1;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 0 PASSWORD_LOCK_TIME 0;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
DROP USER u1;
SET GLOBAL partial_revokes=DEFAULT;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS -1;
CREATE USER goo@localhost FAILED_LOGIN_ATTEMPTS 32768;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 32767;
DROP USER foo@localhost;
CREATE USER foo@localhost PASSWORD_LOCK_TIME -1;
CREATE USER goo@localhost PASSWORD_LOCK_TIME 32768;
CREATE USER foo@localhost PASSWORD_LOCK_TIME 32767;
DROP USER foo@localhost;
CREATE USER ''@localhost IDENTIFIED BY 'pwd' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,non-existent,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,non-existent2,,test);
enable_query_log;
DROP USER ''@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' PASSWORD_LOCK_TIME 3 FAILED_LOGIN_ATTEMPTS 2;
ALTER USER foo@localhost ATTRIBUTE "{ \"test\": \"account locking\" }";
ALTER USER foo@localhost COMMENT "This is a test account for verifying that password locking and user attributes won't interfer with one and another.";
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   CREATE USER foo@localhost IDENTIFIED BY 'foo';
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 4 PASSWORD_LOCK_TIME 6;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost IDENTIFIED BY 'foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
FLUSH PRIVILEGES;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcont,localhost,foo,foo,test);
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
CREATE USER bar@localhost IDENTIFIED BY 'bar';
disable_query_log;
connect(errcon,localhost,bar,,test);
enable_query_log;
connection default;
DROP USER foo@localhost;
DROP USER bar@localhost;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SHOW CREATE USER foo@localhost;
CREATE USER failed_login_attempts@localhost FAILED_LOGIN_ATTEMPTS 2;
SHOW CREATE USER failed_login_attempts@localhost;
CREATE USER password_lock_time@localhost PASSWORD_LOCK_TIME 3;
SHOW CREATE USER password_lock_time@localhost;
DROP USER foo@localhost;
remove_file $file;
DROP USER foo@localhost, failed_login_attempts@localhost, password_lock_time@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
connect(con1,localhost,foo,foo,test);
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": 1}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user,host,user_attributes FROM mysql.user WHERE user='foo';
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": -2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": -2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": "2", "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": "2"}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes=NULL WHERE user='foo';
FLUSH PRIVILEGES;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3 ACCOUNT LOCK;
disable_query_log;
connect(errcon,localhost,foo,foo,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL check_proxy_users = ON;
SET GLOBAL mysql_native_password_proxy_users = ON;
CREATE USER proxied_to_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
CREATE USER proxy_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
GRANT PROXY ON proxied_to_user@localhost TO proxy_user@localhost;
connect(con1,localhost,proxy_user,,test);
SELECT USER(), CURRENT_USER(), @@session.proxy_user;
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxied_to_user,proxied_to_user,test);
enable_query_log;
REVOKE PROXY ON proxied_to_user@localhost FROM proxy_user@localhost;
DROP USER proxied_to_user@localhost, proxy_user@localhost;
SET GLOBAL check_proxy_users = DEFAULT;
SET GLOBAL mysql_native_password_proxy_users = DEFAULT;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 2;
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL partial_revokes=1;
CREATE USER u1 identified by 'pwd';
GRANT CREATE ON *.* TO u1;
REVOKE CREATE ON mysql.* FROM u1;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 0 PASSWORD_LOCK_TIME 0;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
DROP USER u1;
SET GLOBAL partial_revokes=DEFAULT;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS -1;
CREATE USER goo@localhost FAILED_LOGIN_ATTEMPTS 32768;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 32767;
DROP USER foo@localhost;
CREATE USER foo@localhost PASSWORD_LOCK_TIME -1;
CREATE USER goo@localhost PASSWORD_LOCK_TIME 32768;
CREATE USER foo@localhost PASSWORD_LOCK_TIME 32767;
DROP USER foo@localhost;
CREATE USER ''@localhost IDENTIFIED BY 'pwd' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,non-existent,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,non-existent2,,test);
enable_query_log;
DROP USER ''@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' PASSWORD_LOCK_TIME 3 FAILED_LOGIN_ATTEMPTS 2;
ALTER USER foo@localhost ATTRIBUTE "{ \"test\": \"account locking\" }";
ALTER USER foo@localhost COMMENT "This is a test account for verifying that password locking and user attributes won't interfer with one and another.";
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
   let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
      let $wait_counter= `SELECT $wait_timeout * 10`;
while ($wait_counter)   let $current_sessions= query_get_value(SHOW GLOBAL STATUS LIKE 'Threads_connected', Value, 1);
   let $success= `SELECT $current_sessions <= $count_sessions`;
   if ($success)   {      let $wait_counter= 0;
   }   if (!$success)   {      sleep 0.1;
      dec $wait_counter;
   }         SHOW PROCESSLIST;
   CREATE USER foo@localhost IDENTIFIED BY 'foo';
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 4 PASSWORD_LOCK_TIME 6;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
SELECT user_attributes FROM mysql.user WHERE user='foo';
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost IDENTIFIED BY 'foo';
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
FLUSH PRIVILEGES;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcont,localhost,foo,foo,test);
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
CREATE USER bar@localhost IDENTIFIED BY 'bar';
disable_query_log;
connect(errcon,localhost,bar,,test);
enable_query_log;
connection default;
DROP USER foo@localhost;
DROP USER bar@localhost;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SHOW CREATE USER foo@localhost;
CREATE USER failed_login_attempts@localhost FAILED_LOGIN_ATTEMPTS 2;
SHOW CREATE USER failed_login_attempts@localhost;
CREATE USER password_lock_time@localhost PASSWORD_LOCK_TIME 3;
SHOW CREATE USER password_lock_time@localhost;
DROP USER foo@localhost;
remove_file $file;
DROP USER foo@localhost, failed_login_attempts@localhost, password_lock_time@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 0;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
ALTER USER foo@localhost FAILED_LOGIN_ATTEMPTS 2;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
ALTER USER foo@localhost PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
SHOW CREATE USER foo@localhost;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
connect(con1,localhost,foo,foo,test);
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": 1}' WHERE user='foo';
FLUSH PRIVILEGES;
SELECT user,host,user_attributes FROM mysql.user WHERE user='foo';
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": -2, "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": -2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": "2", "password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2, "password_lock_time_days": "2"}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"password_lock_time_days": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes='{"Password_locking": {"failed_login_attempts": 2}}' WHERE user='foo';
FLUSH PRIVILEGES;
SHOW CREATE USER foo@localhost;
UPDATE mysql.user SET user_attributes=NULL WHERE user='foo';
FLUSH PRIVILEGES;
DROP USER foo@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3 ACCOUNT LOCK;
disable_query_log;
connect(errcon,localhost,foo,foo,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,foo,,test);
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL check_proxy_users = ON;
SET GLOBAL mysql_native_password_proxy_users = ON;
CREATE USER proxied_to_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
CREATE USER proxy_user@localhost IDENTIFIED WITH 'mysql_native_password' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
GRANT PROXY ON proxied_to_user@localhost TO proxy_user@localhost;
connect(con1,localhost,proxy_user,,test);
SELECT USER(), CURRENT_USER(), @@session.proxy_user;
connection default;
disconnect con1;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxy_user,proxy_user,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,proxied_to_user,proxied_to_user,test);
enable_query_log;
REVOKE PROXY ON proxied_to_user@localhost FROM proxy_user@localhost;
DROP USER proxied_to_user@localhost, proxy_user@localhost;
SET GLOBAL check_proxy_users = DEFAULT;
SET GLOBAL mysql_native_password_proxy_users = DEFAULT;
CREATE USER foo@localhost IDENTIFIED BY 'foo' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 2;
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
SET GLOBAL partial_revokes=1;
CREATE USER u1 identified by 'pwd';
GRANT CREATE ON *.* TO u1;
REVOKE CREATE ON mysql.* FROM u1;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
ALTER USER u1 FAILED_LOGIN_ATTEMPTS 0 PASSWORD_LOCK_TIME 0;
SELECT user_attributes FROM mysql.user WHERE USER = 'u1';
DROP USER u1;
SET GLOBAL partial_revokes=DEFAULT;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS -1;
CREATE USER goo@localhost FAILED_LOGIN_ATTEMPTS 32768;
CREATE USER foo@localhost FAILED_LOGIN_ATTEMPTS 32767;
DROP USER foo@localhost;
CREATE USER foo@localhost PASSWORD_LOCK_TIME -1;
CREATE USER goo@localhost PASSWORD_LOCK_TIME 32768;
CREATE USER foo@localhost PASSWORD_LOCK_TIME 32767;
DROP USER foo@localhost;
CREATE USER ''@localhost IDENTIFIED BY 'pwd' FAILED_LOGIN_ATTEMPTS 2 PASSWORD_LOCK_TIME 3;
disable_query_log;
connect(errcon,localhost,non-existent,,test);
enable_query_log;
disable_query_log;
connect(errcon,localhost,non-existent2,,test);
enable_query_log;
DROP USER ''@localhost;
CREATE USER foo@localhost IDENTIFIED BY 'foo' PASSWORD_LOCK_TIME 3 FAILED_LOGIN_ATTEMPTS 2;
ALTER USER foo@localhost ATTRIBUTE "{ \"test\": \"account locking\" }";
ALTER USER foo@localhost COMMENT "This is a test account for verifying that password locking and user attributes won't interfer with one and another.";
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
disable_query_log;
change_user foo,,test;
enable_query_log;
ALTER USER foo@localhost ACCOUNT UNLOCK;
SELECT user_attributes FROM mysql.user WHERE user='foo';
disable_query_log;
change_user foo,,test;
enable_query_log;
DROP USER foo@localhost;
