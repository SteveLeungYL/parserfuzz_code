set optimizer_trace_max_mem_size=1048576;
set end_markers_in_json=on;
set optimizer_trace="enabled=on";
SET @old_sql_mode = @@sql_mode;
SET @@sql_mode='ONLY_FULL_GROUP_BY';
create table t1(a int, b int, c int) engine=InnoDB;
create algorithm=merge view v1 as select t1.a*2 as a, t1.b*2 as b, t1.c*2 as c from t1;
show create view v1;
drop view v1;
create algorithm=temptable view v1 as select t1.a*2 as a, t1.b*2 as b, t1.c*2 as c from t1;
show create view v1;
drop view v1;
drop table t1;
CREATE TABLE group_by_test2 ( id int unsigned primary key, cat int unsigned not null, name varchar(10), num int unsigned );
INSERT INTO group_by_test2 (id,cat,name,num) VALUES (1,10,'foo',2), (2,11,'foo',1), (3,22,'bar',3), (4,23,'bar',7), (5,34,'test',7);
ALTER TABLE group_by_test2 ADD UNIQUE INDEX (cat);
DROP TABLE group_by_test2;
CREATE TABLE t1 ( col_int_key INT, col_varchar_key VARCHAR(1) );
CREATE TABLE t2 ( pk INTEGER, col_int_key INTEGER );
CREATE VIEW view_b AS SELECT * FROM t2;
DROP TABLE t1, t2;
DROP VIEW view_b;
create table t1( a int, b int not null, c int not null, d int, unique key(b,c), unique key(b,d) );
create table t3(pk int primary key, b int);
drop table t3;
create table t2 like t1;
delete from t1;
insert into t1 (a,b) values(1,10),(2,20);
insert into t2 (a,b) values(1,-10);
prepare s from 'select t1.a,t2.c from t1 left join t2 on t1.a=t2.c and cos(t2.c+ ? )>0.5 group by t1.a';
execute s using @dummy;
delete from t1;
insert into t1 (a,b) values(1,10),(1,20),(2,30),(2,40);
set @optimizer_switch_saved=@@optimizer_switch;
create algorithm=merge view v1 as select t1.a*2 as a, t1.b as b, t1.c as c, t1.d as d, t1.a as e from t1;
show create view v1;
drop view if exists v1;
create algorithm=merge view v1 as select t1.a*2 as a, t1.b as b from t1;
drop view if exists v1;
create algorithm=merge view v1 as select t1.a*2 as a, t1.b as b from t1 where t1.a=t1.b;
drop view if exists v1;
drop view if exists v1;
drop view if exists v1;
set optimizer_switch=@optimizer_switch_saved;
set @optimizer_switch_saved=@@optimizer_switch;
create algorithm=temptable view v1 as select t1.a*2 as a, t1.b as b, t1.c as c, t1.d as d, t1.a as e from t1;
show create view v1;
drop view if exists v1;
create algorithm=temptable view v1 as select t1.a*2 as a, t1.b as b from t1;
drop view if exists v1;
create algorithm=temptable view v1 as select t1.a*2 as a, t1.b as b from t1 where t1.a=t1.b;
drop view if exists v1;
create algorithm=temptable view v1 as select sum(t1.a) as a, sum(t1.b) as b from t1;
drop view if exists v1;
create algorithm=temptable view v1 as select a, b*5 as b, sum(t1.c) as c, sum(t1.d) as d from t1 group by a,b*5;
drop view if exists v1;
set optimizer_switch=@optimizer_switch_saved;
set @optimizer_switch_saved=@@optimizer_switch;
set optimizer_switch='derived_merge=off';
drop view if exists v1;
drop view if exists v1;
drop view if exists v1;
