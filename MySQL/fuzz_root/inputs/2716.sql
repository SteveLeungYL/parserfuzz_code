set optimizer_switch='block_nested_loop=off,batched_key_access=off';
set optimizer_switch='mrr_cost_based=off';
DROP TABLE IF EXISTS t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11;
DROP DATABASE IF EXISTS world;
set names utf8;
CREATE DATABASE world;
use world;
CREATE TABLE country ( Code char(3) NOT NULL default '', Name char(52) NOT NULL default '', SurfaceArea float(10,2) NOT NULL default '0.00', Population int(11) NOT NULL default '0', Capital int(11) default NULL );
CREATE TABLE city ( ID int(11) NOT NULL, Name char(35) NOT NULL default '', Country char(3) NOT NULL default '', Population int(11) NOT NULL default '0' );
CREATE TABLE countrylanguage ( Country char(3) NOT NULL default '', Language char(30) NOT NULL default '', Percentage float NOT NULL default '0.0' );
ANALYZE TABLE country, city, countrylanguage;
ANALYZE TABLE city, country, countrylanguage;
show variables like 'join_buffer_size';
EXPLAIN SELECT city.Name, country.Name FROM city,country WHERE city.Country=country.Code AND  country.Name LIKE 'L%' AND city.Population > 100000;
EXPLAIN SELECT city.Name, country.Name, countrylanguage.Language FROM city,country,countrylanguage WHERE city.Country=country.Code AND countrylanguage.Country=country.Code AND city.Name LIKE 'L%' AND country.Population > 3000000 AND countrylanguage.Percentage > 50;
set join_buffer_size=2048;
show variables like 'join_buffer_size';
EXPLAIN SELECT city.Name, country.Name FROM city,country WHERE city.Country=country.Code AND  country.Name LIKE 'L%' AND city.Population > 100000;
EXPLAIN SELECT city.Name, country.Name, countrylanguage.Language FROM city,country,countrylanguage WHERE city.Country=country.Code AND countrylanguage.Country=country.Code AND city.Name LIKE 'L%' AND country.Population > 3000000 AND countrylanguage.Percentage > 50;
set join_buffer_size=default;
show variables like 'join_buffer_size';
DROP DATABASE world;
CREATE DATABASE world;
use world;
CREATE TABLE country ( Code char(3) NOT NULL default '', Name char(52) NOT NULL default '', SurfaceArea float(10,2) NOT NULL default '0.00', Population int(11) NOT NULL default '0', Capital int(11) default NULL, PRIMARY KEY  (Code), UNIQUE INDEX (Name) );
CREATE TABLE city ( ID int(11) NOT NULL auto_increment, Name char(35) NOT NULL default '', Country char(3) NOT NULL default '', Population int(11) NOT NULL default '0', PRIMARY KEY  (ID), INDEX (Population), INDEX (Country)  );
CREATE TABLE countrylanguage ( Country char(3) NOT NULL default '', Language char(30) NOT NULL default '', Percentage float NOT NULL default '0.0', PRIMARY KEY  (Country, Language), INDEX (Percentage) );
ANALYZE TABLE country, city, countrylanguage;
ANALYZE TABLE city, country, countrylanguage;
show variables like 'join_buffer_size';
EXPLAIN SELECT city.Name, country.Name FROM city,country WHERE city.country=country.Code AND  country.Name LIKE 'L%' AND city.Population > 100000;
EXPLAIN SELECT city.Name, country.Name, countrylanguage.Language FROM city,country,countrylanguage WHERE city.country=country.Code AND countrylanguage.country=country.Code AND city.Name LIKE 'L%' AND country.Population > 3000000 AND countrylanguage.Percentage > 50;
EXPLAIN SELECT Name FROM city WHERE city.country IN (SELECT Code FROM country WHERE country.Name LIKE 'L%') AND city.Population > 100000;
EXPLAIN SELECT country.Name, IF(ISNULL(countrylanguage.country), NULL, countrylanguage.Percentage) FROM country LEFT JOIN countrylanguage ON (countrylanguage.country=country.Code AND Language='English') WHERE  country.Population > 10000000;
set join_buffer_size=256;
show variables like 'join_buffer_size';
EXPLAIN SELECT city.Name, country.Name FROM city,country WHERE city.country=country.Code AND  country.Name LIKE 'L%' AND city.Population > 100000;
EXPLAIN SELECT city.Name, country.Name, countrylanguage.Language FROM city,country,countrylanguage WHERE city.country=country.Code AND countrylanguage.country=country.Code AND city.Name LIKE 'L%' AND country.Population > 3000000 AND countrylanguage.Percentage > 50;
EXPLAIN SELECT Name FROM city WHERE city.country IN (SELECT Code FROM country WHERE country.Name LIKE 'L%') AND city.Population > 100000;
set join_buffer_size=default;
show variables like 'join_buffer_size';
set join_buffer_size=256;
EXPLAIN SELECT city.Name, country.Name FROM city,country WHERE city.country=country.Code AND city.Population > 3000000;
set join_buffer_size=default;
ALTER TABLE country MODIFY Name varchar(52) NOT NULL default '';
ALTER TABLE country MODIFY Name varchar(250) NOT NULL default '';
ALTER TABLE country ADD COLUMN PopulationBar text;
UPDATE country  SET PopulationBar=REPEAT('x', CAST(Population/100000 AS unsigned int));
set join_buffer_size=256;
set join_buffer_size=default;
DROP DATABASE world;
use test;
CREATE TABLE t1( affiliatetometaid int  NOT NULL default '0', uniquekey int NOT NULL default '0', metaid int  NOT NULL default '0', affiliateid int  NOT NULL default '0', xml text, isactive char(1) NOT NULL default 'Y', PRIMARY KEY  (affiliatetometaid) );
CREATE UNIQUE INDEX t1_uniquekey ON t1(uniquekey);
CREATE INDEX t1_affiliateid ON t1(affiliateid);
CREATE INDEX t1_metaid on t1 (metaid);
INSERT INTO t1 VALUES (1616, 1571693233, 1391, 2, NULL, 'Y'), (1943, 1993216749, 1726, 2, NULL, 'Y');
CREATE TABLE t2( metaid int  NOT NULL default '0', name varchar(80) NOT NULL default '', dateadded timestamp NOT NULL , xml text, status int default NULL, origin int default NULL, gid int NOT NULL default '1', formattypeid int  default NULL, PRIMARY KEY  (metaid) );
CREATE INDEX t2_status ON t2(status);
CREATE INDEX t2_gid ON t2(gid);
CREATE INDEX t2_formattypeid ON t2(formattypeid);
INSERT INTO t2 VALUES (1391, "I Just Died", "2003-10-02 10:07:37", "", 1, NULL, 3, NULL), (1726, "Me, Myself & I", "2003-12-05 11:24:36", " ", 1, NULL, 3, NULL);
