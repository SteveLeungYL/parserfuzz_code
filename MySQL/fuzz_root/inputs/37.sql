CREATE FUNCTION service_get_read_locks  RETURNS INT SONAME "locking_service.so";
CREATE FUNCTION service_get_write_locks RETURNS INT SONAME "locking_service.so";
CREATE FUNCTION service_release_locks   RETURNS INT SONAME "locking_service.so";
UPDATE performance_schema.setup_instruments SET enabled = 'NO', timed = 'YES';
TRUNCATE TABLE performance_schema.events_waits_current;
TRUNCATE TABLE performance_schema.events_waits_history_long;
UPDATE performance_schema.setup_instruments SET enabled = 'YES' WHERE name = 'wait/lock/metadata/sql/mdl';
reap;
show session status;
reap;
SET SESSION AUTOCOMMIT = OFF;
COMMIT;
ROLLBACK;
SET @aux = 1;
reap;
show session status;
reap;
COMMIT WORK RELEASE;
reap;
SET @aux = 14;
KILL @aux;
reap;
KILL 15;
reap;
reap;
reap;
reap;
reap;
SET @aux = 1;
reap;
SET @aux = 1;
reap;
CREATE TEMPORARY TABLE t1 AS SELECT 1 AS col1;
CREATE TEMPORARY TABLE t1 AS SELECT service_get_write_locks('holder_name_space', 'lock', 0) AS col1;
DROP TEMPORARY TABLE t1;
CREATE TABLE t1 (col1 VARCHAR(10));
INSERT INTO t1 VALUES ('l1'), ('l2'), ('l3');
CREATE TEMPORARY TABLE t2 ENGINE = InnoDB AS SELECT service_get_write_locks('holder_name_space', col1, 0) AS col1 FROM t1 ORDER BY col1;
DROP TEMPORARY TABLE t2;
DROP TABLE t1;
FLUSH TABLES;
DROP FUNCTION service_get_read_locks;
DROP FUNCTION service_get_write_locks;
DROP FUNCTION service_release_locks;
UPDATE performance_schema.setup_instruments SET enabled = 'YES';
