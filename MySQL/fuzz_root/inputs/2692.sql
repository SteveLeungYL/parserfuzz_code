SET SESSION information_schema_stats_expiry=0;
CREATE TABLE t1 ( a INT, KEY (a) );
SHOW KEYS FROM t1;
ALTER TABLE t1 ALTER INDEX a INVISIBLE;
SHOW KEYS FROM t1;
ALTER TABLE t1 ALTER INDEX a VISIBLE;
SHOW KEYS FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, b INT );
CREATE INDEX a_invisible ON t1(a) INVISIBLE;
CREATE INDEX b_visible ON t1(a) VISIBLE;
CREATE INDEX a_b_invisible ON t1(a, b) INVISIBLE;
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, KEY (a) );
CREATE TABLE t2 ( a INT, KEY (a) INVISIBLE );
INSERT INTO t1 VALUES (1), (2), (3), (4), (5);
INSERT INTO t2 SELECT * FROM t1;
ANALYZE TABLE t1, t2;
EXPLAIN SELECT a FROM t1;
ALTER TABLE t1 ALTER INDEX a INVISIBLE;
EXPLAIN SELECT a FROM t1;
ALTER TABLE t1 ALTER INDEX a VISIBLE;
EXPLAIN SELECT a FROM t1;
EXPLAIN SELECT a FROM t2;
ALTER TABLE t2 ALTER INDEX a VISIBLE;
EXPLAIN SELECT a FROM t2;
DROP TABLE t1, t2;
CREATE TABLE t1 ( a INT, INDEX (a), b INT, INDEX (b) INVISIBLE );
SHOW INDEXES FROM t1;
ALTER TABLE t1 RENAME INDEX a TO a1;
ALTER TABLE t1 RENAME INDEX b TO b1;
SHOW INDEXES FROM t1;
ALTER TABLE t1 ALTER INDEX a1 INVISIBLE;
ALTER TABLE t1 ALTER INDEX b1 VISIBLE;
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, b INT, c INT, INDEX (a) VISIBLE, INDEX (b) INVISIBLE, INDEX (c) );
SHOW CREATE TABLE t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, PRIMARY KEY (a) INVISIBLE );
ALTER TABLE t1 ALTER INDEX PRIMARY INVISIBLE;
ALTER TABLE t1 ADD PRIMARY KEY (a) INVISIBLE;
CREATE TABLE t1( a INT );
ALTER TABLE t1 ADD CONSTRAINT pk PRIMARY KEY (a);
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1( a INT, PRIMARY KEY pk (a) );
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, KEY (a), b INT, KEY (b) INVISIBLE );
ALTER TABLE t1 RENAME INDEX no_such_index TO x;
ALTER TABLE t1 ALTER INDEX no_such_index INVISIBLE;
ALTER TABLE t1 ALTER INDEX a INVISIBLE, ALTER INDEX a VISIBLE;
ALTER TABLE t1 ALTER INDEX a INVISIBLE, ALTER INDEX b VISIBLE;
SHOW INDEXES FROM t1;
ALTER TABLE t1 RENAME INDEX a TO x, RENAME INDEX x TO a;
ALTER TABLE t1 RENAME INDEX a TO x, ALTER INDEX x INVISIBLE;
ALTER TABLE t1 RENAME INDEX a TO x, ALTER INDEX a VISIBLE;
ALTER TABLE t1 ALTER INDEX a VISIBLE, RENAME INDEX a TO x;
INSERT INTO t1 VALUES (1, 1), (2, 2), (3, 3);
ANALYZE TABLE t1;
