set @orig_partial_revokes = @@global.partial_revokes;
SET GLOBAL partial_revokes= OFF;
CREATE ROLE r1;
CREATE USER u1@localhost IDENTIFIED BY 'foo';
SHOW GRANTS FOR u1@localhost;
CREATE DATABASE db1;
CREATE TABLE db1.t1 (c1 INT, c2 INT, c3 INT);
CREATE TABLE db1.t2 (c1 INT, c2 INT, c3 INT);
GRANT SELECT ON *.* TO r1;
GRANT r1 TO u1@localhost;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
UPDATE db1.t1 SET c1=2;
SELECT * FROM db1.t1;
REVOKE SELECT ON *.* FROM r1;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
SHOW GRANTS FOR CURRENT_USER() USING r1;
SELECT * FROM db1.t1;
GRANT SELECT ON db1.* TO r1;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
UPDATE db1.t1 SET c1=2;
SELECT * FROM db1.t1;
SET ROLE NONE;
SELECT * FROM db1.t1;
SET ROLE r1;
SELECT * FROM db1.t1;
REVOKE SELECT ON db1.* FROM r1;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
SELECT * FROM db1.t1;
GRANT SELECT ON db1.t1 TO r1;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
UPDATE db1.t1 SET c1=2;
SELECT * FROM db1.t2;
SELECT * FROM db1.t1;
REVOKE SELECT ON db1.t1 FROM r1;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
SELECT * FROM db1.t1;
GRANT SELECT(c1) ON db1.t1 TO r1;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
UPDATE db1.t1 SET c1=2;
SELECT c1 FROM db1.t2;
SELECT c2 FROM db1.t1;
SELECT c1 FROM db1.t1;
REVOKE SELECT(c1) ON db1.t1 FROM r1;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
SELECT * FROM db1.t1;
DROP ROLE r1;
DROP USER u1@localhost;
DROP DATABASE db1;
CREATE ROLE r1;
CREATE ROLE r2;
CREATE USER u1@localhost IDENTIFIED BY 'foo';
SHOW GRANTS FOR u1@localhost;
CREATE DATABASE db1;
CREATE DATABASE db2;
CREATE TABLE db1.t1 (c1 INT, c2 INT, c3 INT);
CREATE TABLE db1.t2 (c1 INT, c2 INT, c3 INT);
CREATE TABLE db1.t3 (c1 INT, c2 INT, c3 INT);
CREATE TABLE db2.t1 (c1 INT, c2 INT, c3 INT);
CREATE TABLE db2.t2 (c1 INT, c2 INT, c3 INT);
GRANT SELECT ON *.* TO r2;
GRANT SELECT ON db1.t2 TO r1 WITH GRANT OPTION;
GRANT r2 TO r1;
GRANT r1 TO u1@localhost;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
UPDATE db1.t1 SET c1=2;
UPDATE db1.t2 SET c1=2;
GRANT SELECT ON *.* TO u1@localhost;
GRANT SELECT ON db1.* TO u1@localhost;
GRANT SELECT ON db1.t1 TO u1@localhost;
SELECT * FROM db1.t1;
SELECT * FROM db1.t2;
GRANT SELECT ON db1.t2 TO u1@localhost;
REVOKE SELECT ON db1.t2 FROM u1@localhost;
GRANT SELECT (c1) ON db1.t2 TO u1@localhost;
REVOKE SELECT (c1) ON db1.t2 FROM u1@localhost;
REVOKE SELECT ON *.* FROM r2;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
SELECT * FROM db1.t1;
SELECT * FROM db1.t2;
GRANT SELECT ON db1.* TO r2;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
UPDATE db1.t1 SET c1=2;
UPDATE db1.t2 SET c1=2;
SELECT * FROM db2.t1;
SELECT * FROM db2.t2;
SELECT * FROM db1.t1;
SELECT * FROM db1.t2;
REVOKE SELECT ON db1.* FROM r2;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
SELECT * FROM db1.t1;
GRANT SELECT ON db1.t1 TO r2;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
UPDATE db1.t1 SET c1=2;
SELECT * FROM db1.t3;
SELECT * FROM db1.t1;
SELECT * FROM db1.t2;
REVOKE SELECT ON db1.t1 FROM r2;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
SELECT * FROM db1.t1;
GRANT SELECT(c1) ON db1.t1 TO r2;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
UPDATE db1.t1 SET c1=2;
SELECT c1 FROM db1.t3;
SELECT c2 FROM db1.t1;
SELECT c1 FROM db1.t1;
SELECT * FROM db1.t2;
REVOKE SELECT(c1) ON db1.t1 FROM r2;
SHOW GRANTS FOR u1@localhost USING r1;
SET ROLE r1;
SELECT * FROM db1.t1;
DROP ROLE r1;
DROP ROLE r2;
DROP USER u1@localhost;
DROP DATABASE db1;
DROP DATABASE db2;
CREATE ROLE r1;
CREATE ROLE r2;
CREATE USER u1@localhost IDENTIFIED BY 'foo';
SHOW GRANTS FOR u1@localhost;
CREATE DATABASE db1;
CREATE DATABASE db2;
CREATE TABLE db1.t1 (c1 INT, c2 INT, c3 INT);
CREATE TABLE db1.t2 (c1 INT, c2 INT, c3 INT);
CREATE TABLE db1.t3 (c1 INT, c2 INT, c3 INT);
CREATE TABLE db2.t1 (c1 INT, c2 INT, c3 INT);
CREATE TABLE db2.t2 (c1 INT, c2 INT, c3 INT);
GRANT SELECT ON *.* TO r2;
GRANT SELECT ON db1.t2 TO r1;
GRANT r1 TO u1@localhost;
GRANT r2 TO u1@localhost;
SHOW GRANTS FOR u1@localhost USING r1,r2;
SET ROLE r1,r2;
UPDATE db1.t1 SET c1=2;
UPDATE db1.t2 SET c1=2;
SELECT * FROM db1.t1;
SELECT * FROM db1.t2;
REVOKE SELECT ON *.* FROM r2;
SHOW GRANTS FOR u1@localhost USING r1,r2;
SET ROLE r1,r2;
SELECT * FROM db1.t1;
SELECT * FROM db1.t2;
GRANT SELECT ON db1.* TO r2;
SHOW GRANTS FOR u1@localhost USING r1,r2;
SET ROLE r1,r2;
UPDATE db1.t1 SET c1=2;
UPDATE db1.t2 SET c1=2;
SELECT * FROM db2.t1;
SELECT * FROM db2.t2;
SELECT * FROM db1.t1;
SELECT * FROM db1.t2;
REVOKE SELECT ON db1.* FROM r2;
SHOW GRANTS FOR u1@localhost USING r1,r2;
SET ROLE r1,r2;
SELECT * FROM db1.t1;
GRANT SELECT ON db1.t1 TO r2;
SHOW GRANTS FOR u1@localhost USING r1,r2;
SET ROLE r1,r2;
UPDATE db1.t1 SET c1=2;
SELECT * FROM db1.t3;
SELECT * FROM db1.t1;
SELECT * FROM db1.t2;
REVOKE SELECT ON db1.t1 FROM r2;
SHOW GRANTS FOR u1@localhost USING r1,r2;
SET ROLE r1,r2;
SELECT * FROM db1.t1;
GRANT SELECT(c1) ON db1.t1 TO r2;
SHOW GRANTS FOR u1@localhost USING r1,r2;
SET ROLE r1,r2;
UPDATE db1.t1 SET c1=2;
SELECT c1 FROM db1.t3;
SELECT c2 FROM db1.t1;
SELECT c1 FROM db1.t1;
SELECT * FROM db1.t2;
REVOKE SELECT(c1) ON db1.t1 FROM r2;
SHOW GRANTS FOR u1@localhost USING r1,r2;
SET ROLE r1,r2;
SELECT * FROM db1.t1;
DROP ROLE r1;
DROP ROLE r2;
DROP USER u1@localhost;
SHOW STATUS LIKE '%Acl_cache%';
DROP DATABASE db1;
DROP DATABASE db2;
CREATE ROLE r1, r2, r3, r4;
CREATE USER u1@localhost IDENTIFIED BY 'foo';
CREATE USER u2@localhost IDENTIFIED BY 'foo';
SHOW GRANTS FOR u1@localhost;
CREATE DATABASE db1;
CREATE DATABASE db2;
CREATE DATABASE db1aaaa;
CREATE DATABASE dddddb1;
CREATE DATABASE secdb1;
CREATE DATABASE secdb2;
CREATE TABLE db1.t1 (c1 INT);
CREATE TABLE db2.t1 (c2 INT);
CREATE TABLE dddddb1.t1 (c2 INT);
CREATE TABLE db1aaaa.t1 (c2 INT);
CREATE TABLE secdb1.t1 (c1 INT);
CREATE TABLE secdb2.t1 (c2 INT);
INSERT INTO db1.t1 VALUES (1),(2),(3);
INSERT INTO db2.t1 VALUES (1),(2),(3);
INSERT INTO dddddb1.t1 VALUES (1),(2),(3);
INSERT INTO db1aaaa.t1 VALUES (1),(2),(3);
GRANT SELECT ON `db_`.* TO r1;
GRANT SELECT ON `db%`.* TO r2;
GRANT SELECT ON `db%`.* TO r3 WITH GRANT OPTION;
GRANT SELECT ON `secdb1`.* TO r4 WITH GRANT OPTION;
GRANT r1,r2,r3,r4 TO u1@localhost;
SET ROLE r1;
SHOW GRANTS;
SELECT * FROM db1.t1;
SELECT * FROM db2.t1;
SELECT * FROM db1aaaa.t1;
SELECT * FROM dddddb1.t1;
SET ROLE r2;
SELECT * FROM db1.t1;
SELECT * FROM db2.t1;
SELECT * FROM db1aaaa.t1;
SELECT * FROM dddddb1.t1;
GRANT SELECT ON db1.* TO u2@localhost;
SET ROLE r3;
SELECT * FROM db1.t1;
SELECT * FROM db2.t1;
SELECT * FROM db1aaaa.t1;
GRANT SELECT ON db1.* TO u2@localhost;
GRANT SELECT ON db_.* TO u2@localhost;
GRANT SELECT ON `%db1`.* TO u2@localhost;
SET ROLE r4;
GRANT SELECT ON `secdb1`.* TO u2@localhost;
GRANT SELECT ON `secdb1`.`t1` TO u2@localhost;
GRANT SELECT ON `secdb%`.* TO u2@localhost;
GRANT SELECT ON `secdb_`.* TO u2@localhost;
GRANT SELECT ON `secdb_`.`t1` TO u2@localhost;
GRANT INSERT ON `%db1`.* TO r1;
SET ROLE r1;
INSERT INTO dddddb1.t1 VALUES (1);
INSERT INTO db2.t1 VALUES (1);
DROP ROLE r1,r2,r3,r4;
DROP USER u1@localhost, u2@localhost;
DROP DATABASE db1;
DROP DATABASE db2;
DROP DATABASE db1aaaa;
DROP DATABASE dddddb1;
DROP DATABASE secdb1;
DROP DATABASE secdb2;
SET GLOBAL partial_revokes = @orig_partial_revokes;
CREATE USER 'u1'@'' IDENTIFIED BY '123';
GRANT SELECT ON *.* TO 'u1'@'';
CREATE USER 'r1'@'' IDENTIFIED BY '123';
CREATE USER 'r2'@'' IDENTIFIED BY '123';
GRANT 'r1'@'' TO 'u1'@'';
GRANT 'r2'@'' TO 'u1'@'';
SET DEFAULT ROLE 'r1'@'', 'r2'@'' TO 'u1'@'';
REVOKE 'r1'@'' FROM 'u1'@'';
REVOKE 'r2'@'' FROM 'u1'@'';
DROP USER 'u1'@'','r1'@'','r2'@'';
