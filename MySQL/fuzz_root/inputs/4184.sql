drop table if exists t1,t2;
create table t1 (a int not null auto_increment, b int not null, primary key(a));
insert into t1 (b) values (2),(3),(5),(5),(5),(6),(7),(9);
select SQL_CALC_FOUND_ROWS * from t1;
select found_rows();
select SQL_CALC_FOUND_ROWS * from t1 limit 1;
select found_rows();
select SQL_BUFFER_RESULT SQL_CALC_FOUND_ROWS * from t1 limit 1;
select found_rows();
select SQL_CALC_FOUND_ROWS * from t1 order by b desc limit 1;
select found_rows();
select SQL_CALC_FOUND_ROWS distinct b from t1 limit 1;
select found_rows();
select SQL_CALC_FOUND_ROWS b,count(*) as c from t1 group by b order by c desc limit 1;
select found_rows();
select SQL_CALC_FOUND_ROWS * from t1 left join t1 as t2 on (t1.b=t2.a) limit 2,1;
select found_rows();
ANALYZE TABLE t1;
EXPLAIN FORMAT=tree select SQL_CALC_FOUND_ROWS * from t1 limit 10 offset 100;
select SQL_CALC_FOUND_ROWS * from t1 limit 10 offset 100;
select found_rows();
drop table t1;
create table t1 (a int not null primary key);
insert into t1 values (1),(2),(3),(4),(5);
select sql_calc_found_rows a from t1 where a in (1,2,3) order by a desc limit 0,2;
select FOUND_ROWS();
select sql_calc_found_rows a from t1 where a in (1,2,3) order by a+2 desc limit 0,2;
select FOUND_ROWS();
drop table t1;
CREATE TABLE t1 ( `id` smallint(5) unsigned NOT NULL auto_increment, `kid` smallint(5) unsigned NOT NULL default '0', PRIMARY KEY (`id`), KEY `kid` (`kid`) ) charset utf8mb4;
CREATE TABLE t2 ( id smallint(5) unsigned NOT NULL auto_increment, name varchar(50) NOT NULL default '', email varchar(50) NOT NULL default '', PRIMARY KEY  (id), UNIQUE KEY e_n (email,name) ) charset utf8mb4;
INSERT INTO t2 VALUES (1,'name1','email1');
INSERT INTO t2 VALUES (2,'name2','email2');
INSERT INTO t2 VALUES (3,'name3','email3');
INSERT INTO t2 VALUES (4,'name4','email4');
INSERT INTO t2 VALUES (5,'name5','email5');
INSERT INTO t2 VALUES (6,'name6','email6');
INSERT INTO t2 VALUES (7,'name7','email7');
INSERT INTO t2 VALUES (8,'name8','email8');
INSERT INTO t2 VALUES (9,'name9','email9');
INSERT INTO t2 VALUES (10,'name10','email10');
INSERT INTO t2 VALUES (11,'name11','email11');
INSERT INTO t2 VALUES (12,'name12','email12');
INSERT INTO t2 VALUES (13,'name13','email13');
INSERT INTO t2 VALUES (14,'name14','email14');
INSERT INTO t2 VALUES (15,'name15','email15');
INSERT INTO t2 VALUES (16,'name16','email16');
INSERT INTO t2 VALUES (17,'name17','email17');
INSERT INTO t2 VALUES (18,'name18','email18');
INSERT INTO t2 VALUES (19,'name19','email19');
INSERT INTO t2 VALUES (20,'name20','email20');
INSERT INTO t2 VALUES (21,'name21','email21');
INSERT INTO t2 VALUES (22,'name22','email22');
INSERT INTO t2 VALUES (23,'name23','email23');
INSERT INTO t2 VALUES (24,'name24','email24');
INSERT INTO t2 VALUES (25,'name25','email25');
INSERT INTO t2 VALUES (26,'name26','email26');
INSERT INTO t2 VALUES (27,'name27','email27');
INSERT INTO t2 VALUES (28,'name28','email28');
INSERT INTO t2 VALUES (29,'name29','email29');
INSERT INTO t2 VALUES (30,'name30','email30');
INSERT INTO t2 VALUES (31,'name31','email31');
INSERT INTO t2 VALUES (32,'name32','email32');
INSERT INTO t2 VALUES (33,'name33','email33');
INSERT INTO t2 VALUES (34,'name34','email34');
INSERT INTO t2 VALUES (35,'name35','email35');
INSERT INTO t2 VALUES (36,'name36','email36');
INSERT INTO t2 VALUES (37,'name37','email37');
INSERT INTO t2 VALUES (38,'name38','email38');
INSERT INTO t2 VALUES (39,'name39','email39');
INSERT INTO t2 VALUES (40,'name40','email40');
INSERT INTO t2 VALUES (41,'name41','email41');
INSERT INTO t2 VALUES (42,'name42','email42');
INSERT INTO t2 VALUES (43,'name43','email43');
INSERT INTO t2 VALUES (44,'name44','email44');
INSERT INTO t2 VALUES (45,'name45','email45');
INSERT INTO t2 VALUES (46,'name46','email46');
INSERT INTO t2 VALUES (47,'name47','email47');
INSERT INTO t2 VALUES (48,'name48','email48');
INSERT INTO t2 VALUES (49,'name49','email49');
INSERT INTO t2 VALUES (50,'name50','email50');
INSERT INTO t2 VALUES (51,'name51','email51');
INSERT INTO t2 VALUES (52,'name52','email52');
INSERT INTO t2 VALUES (53,'name53','email53');
INSERT INTO t2 VALUES (54,'name54','email54');
INSERT INTO t2 VALUES (55,'name55','email55');
INSERT INTO t2 VALUES (56,'name56','email56');
INSERT INTO t2 VALUES (57,'name57','email57');
INSERT INTO t2 VALUES (58,'name58','email58');
INSERT INTO t2 VALUES (59,'name59','email59');
INSERT INTO t2 VALUES (60,'name60','email60');
INSERT INTO t2 VALUES (61,'name61','email61');
INSERT INTO t2 VALUES (62,'name62','email62');
INSERT INTO t2 VALUES (63,'name63','email63');
INSERT INTO t2 VALUES (64,'name64','email64');
INSERT INTO t2 VALUES (65,'name65','email65');
INSERT INTO t2 VALUES (66,'name66','email66');
INSERT INTO t2 VALUES (67,'name67','email67');
INSERT INTO t2 VALUES (68,'name68','email68');
INSERT INTO t2 VALUES (69,'name69','email69');
INSERT INTO t2 VALUES (70,'name70','email70');
INSERT INTO t2 VALUES (71,'name71','email71');
INSERT INTO t2 VALUES (72,'name72','email72');
INSERT INTO t2 VALUES (73,'name73','email73');
INSERT INTO t2 VALUES (74,'name74','email74');
INSERT INTO t2 VALUES (75,'name75','email75');
INSERT INTO t2 VALUES (76,'name76','email76');
INSERT INTO t2 VALUES (77,'name77','email77');
INSERT INTO t2 VALUES (78,'name78','email78');
INSERT INTO t2 VALUES (79,'name79','email79');
INSERT INTO t2 VALUES (80,'name80','email80');
INSERT INTO t2 VALUES (81,'name81','email81');
INSERT INTO t2 VALUES (82,'name82','email82');
INSERT INTO t2 VALUES (83,'name83','email83');
INSERT INTO t2 VALUES (84,'name84','email84');
INSERT INTO t2 VALUES (85,'name85','email85');
INSERT INTO t2 VALUES (86,'name86','email86');
INSERT INTO t2 VALUES (87,'name87','email87');
INSERT INTO t2 VALUES (88,'name88','email88');
INSERT INTO t2 VALUES (89,'name89','email89');
INSERT INTO t2 VALUES (90,'name90','email90');
INSERT INTO t2 VALUES (91,'name91','email91');
INSERT INTO t2 VALUES (92,'name92','email92');
INSERT INTO t2 VALUES (93,'name93','email93');
INSERT INTO t2 VALUES (94,'name94','email94');
INSERT INTO t2 VALUES (95,'name95','email95');
INSERT INTO t2 VALUES (96,'name96','email96');
INSERT INTO t2 VALUES (97,'name97','email97');
INSERT INTO t2 VALUES (98,'name98','email98');
INSERT INTO t2 VALUES (99,'name99','email99');
INSERT INTO t2 VALUES (100,'name100','email100');
INSERT INTO t2 VALUES (101,'name101','email101');
INSERT INTO t2 VALUES (102,'name102','email102');
INSERT INTO t2 VALUES (103,'name103','email103');
INSERT INTO t2 VALUES (104,'name104','email104');
INSERT INTO t2 VALUES (105,'name105','email105');
INSERT INTO t2 VALUES (106,'name106','email106');
INSERT INTO t2 VALUES (107,'name107','email107');
INSERT INTO t2 VALUES (108,'name108','email108');
INSERT INTO t2 VALUES (109,'name109','email109');
INSERT INTO t2 VALUES (110,'name110','email110');
INSERT INTO t2 VALUES (111,'name111','email111');
INSERT INTO t2 VALUES (112,'name112','email112');
INSERT INTO t2 VALUES (113,'name113','email113');
INSERT INTO t2 VALUES (114,'name114','email114');
INSERT INTO t2 VALUES (115,'name115','email115');
INSERT INTO t2 VALUES (116,'name116','email116');
INSERT INTO t2 VALUES (117,'name117','email117');
INSERT INTO t2 VALUES (118,'name118','email118');
INSERT INTO t2 VALUES (119,'name119','email119');
INSERT INTO t2 VALUES (120,'name120','email120');
INSERT INTO t2 VALUES (121,'name121','email121');
INSERT INTO t2 VALUES (122,'name122','email122');
INSERT INTO t2 VALUES (123,'name123','email123');
INSERT INTO t2 VALUES (124,'name124','email124');
INSERT INTO t2 VALUES (125,'name125','email125');
INSERT INTO t2 VALUES (126,'name126','email126');
INSERT INTO t2 VALUES (127,'name127','email127');
INSERT INTO t2 VALUES (128,'name128','email128');
INSERT INTO t2 VALUES (129,'name129','email129');
INSERT INTO t2 VALUES (130,'name130','email130');
INSERT INTO t2 VALUES (131,'name131','email131');
INSERT INTO t2 VALUES (132,'name132','email132');
INSERT INTO t2 VALUES (133,'name133','email133');
INSERT INTO t2 VALUES (134,'name134','email134');
INSERT INTO t2 VALUES (135,'name135','email135');
INSERT INTO t2 VALUES (136,'name136','email136');
INSERT INTO t2 VALUES (137,'name137','email137');
INSERT INTO t2 VALUES (138,'name138','email138');
INSERT INTO t2 VALUES (139,'name139','email139');
INSERT INTO t2 VALUES (140,'name140','email140');
INSERT INTO t2 VALUES (141,'name141','email141');
INSERT INTO t2 VALUES (142,'name142','email142');
INSERT INTO t2 VALUES (143,'name143','email143');
INSERT INTO t2 VALUES (144,'name144','email144');
INSERT INTO t2 VALUES (145,'name145','email145');
INSERT INTO t2 VALUES (146,'name146','email146');
INSERT INTO t2 VALUES (147,'name147','email147');
INSERT INTO t2 VALUES (148,'name148','email148');
INSERT INTO t2 VALUES (149,'name149','email149');
INSERT INTO t2 VALUES (150,'name150','email150');
INSERT INTO t2 VALUES (151,'name151','email151');
INSERT INTO t2 VALUES (152,'name152','email152');
INSERT INTO t2 VALUES (153,'name153','email153');
INSERT INTO t2 VALUES (154,'name154','email154');
INSERT INTO t2 VALUES (155,'name155','email155');
INSERT INTO t2 VALUES (156,'name156','email156');
INSERT INTO t2 VALUES (157,'name157','email157');
INSERT INTO t2 VALUES (158,'name158','email158');
INSERT INTO t2 VALUES (159,'name159','email159');
INSERT INTO t2 VALUES (160,'name160','email160');
INSERT INTO t2 VALUES (161,'name161','email161');
INSERT INTO t2 VALUES (162,'name162','email162');
INSERT INTO t2 VALUES (163,'name163','email163');
INSERT INTO t2 VALUES (164,'name164','email164');
INSERT INTO t2 VALUES (165,'name165','email165');
INSERT INTO t2 VALUES (166,'name166','email166');
INSERT INTO t2 VALUES (167,'name167','email167');
INSERT INTO t2 VALUES (168,'name168','email168');
INSERT INTO t2 VALUES (169,'name169','email169');
INSERT INTO t2 VALUES (170,'name170','email170');
INSERT INTO t2 VALUES (171,'name171','email171');
INSERT INTO t2 VALUES (172,'name172','email172');
INSERT INTO t2 VALUES (173,'name173','email173');
INSERT INTO t2 VALUES (174,'name174','email174');
INSERT INTO t2 VALUES (175,'name175','email175');
INSERT INTO t2 VALUES (176,'name176','email176');
INSERT INTO t2 VALUES (177,'name177','email177');
INSERT INTO t2 VALUES (178,'name178','email178');
INSERT INTO t2 VALUES (179,'name179','email179');
INSERT INTO t2 VALUES (180,'name180','email180');
INSERT INTO t2 VALUES (181,'name181','email181');
INSERT INTO t2 VALUES (182,'name182','email182');
INSERT INTO t2 VALUES (183,'name183','email183');
INSERT INTO t2 VALUES (184,'name184','email184');
INSERT INTO t2 VALUES (185,'name185','email185');
INSERT INTO t2 VALUES (186,'name186','email186');
INSERT INTO t2 VALUES (187,'name187','email187');
INSERT INTO t2 VALUES (188,'name188','email188');
INSERT INTO t2 VALUES (189,'name189','email189');
INSERT INTO t2 VALUES (190,'name190','email190');
INSERT INTO t2 VALUES (191,'name191','email191');
INSERT INTO t2 VALUES (192,'name192','email192');
INSERT INTO t2 VALUES (193,'name193','email193');
INSERT INTO t2 VALUES (194,'name194','email194');
INSERT INTO t2 VALUES (195,'name195','email195');
INSERT INTO t2 VALUES (196,'name196','email196');
INSERT INTO t2 VALUES (197,'name197','email197');
INSERT INTO t2 VALUES (198,'name198','email198');
INSERT INTO t2 VALUES (199,'name199','email199');
INSERT INTO t2 VALUES (200,'name200','email200');
ANALYZE TABLE t1, t2;
EXPLAIN SELECT SQL_CALC_FOUND_ROWS DISTINCT email FROM t2 LEFT JOIN t1  ON kid = t2.id WHERE t1.id IS NULL LIMIT 10;
FLUSH STATUS;
SELECT SQL_CALC_FOUND_ROWS DISTINCT email FROM t2 LEFT JOIN t1  ON kid = t2.id WHERE t1.id IS NULL LIMIT 10;
SHOW SESSION STATUS LIKE 'Sort_scan%';
SELECT SQL_CALC_FOUND_ROWS DISTINCT email FROM t2 LEFT JOIN t1  ON kid = t2.id WHERE t1.id IS NULL LIMIT 10;
SELECT FOUND_ROWS();
SELECT SQL_CALC_FOUND_ROWS DISTINCT email FROM t2 LEFT JOIN t1  ON kid = t2.id WHERE t1.id IS NULL order by email LIMIT 10;
SELECT FOUND_ROWS();
SELECT DISTINCT email FROM t2 LEFT JOIN t1  ON kid = t2.id WHERE t1.id IS NULL LIMIT 10;
SELECT DISTINCT email FROM t2 LEFT JOIN t1  ON kid = t2.id WHERE t1.id IS NULL ORDER BY email LIMIT 10;
INSERT INTO `t1` (`id`, `kid`) VALUES ('0', '150');
SELECT SQL_CALC_FOUND_ROWS DISTINCT email FROM t2 LEFT JOIN t1  ON kid = t2.id WHERE t1.id IS NULL LIMIT 10;
SELECT FOUND_ROWS();
drop table t1,t2;
CREATE TABLE `t1` ( `titre` char(80) NOT NULL default '', `numeropost` mediumint(8) unsigned NOT NULL auto_increment, `maxnumrep` int(10) unsigned NOT NULL default '0', PRIMARY KEY  (`numeropost`), KEY `maxnumrep` (`maxnumrep`) ) ENGINE=MyISAM ROW_FORMAT=FIXED;
INSERT INTO t1 (titre,maxnumrep) VALUES ('test1','1'),('test2','2'),('test3','3');
SELECT SQL_CALC_FOUND_ROWS titre,numeropost,maxnumrep FROM t1 WHERE numeropost IN (1,2) ORDER BY maxnumrep DESC LIMIT 0, 1;
SELECT FOUND_ROWS();
SELECT SQL_CALC_FOUND_ROWS 1 FROM (SELECT 1) as a LIMIT 0;
SELECT FOUND_ROWS();
SELECT SQL_CALC_FOUND_ROWS * FROM t1 WHERE numeropost > 1  LIMIT 0;
SELECT FOUND_ROWS();
SELECT SQL_CALC_FOUND_ROWS * FROM t1 LIMIT 0;
SELECT FOUND_ROWS();
SELECT SQL_CALC_FOUND_ROWS * FROM t1 ORDER BY numeropost  LIMIT 0;
SELECT FOUND_ROWS();
drop table t1;
create table t1 (id int, primary key (id));
insert into t1 values (1), (2), (3), (4), (5);
select SQL_CALC_FOUND_ROWS * from t1 where id > 3 limit 0, 1;
select FOUND_ROWS();
select SQL_CALC_FOUND_ROWS * from t1 where id > 3 AND 1=2 limit 0, 1;
select FOUND_ROWS();
select SQL_CALC_FOUND_ROWS * from t1 where id > 6 limit 0, 1;
select FOUND_ROWS();
drop table t1;
CREATE TABLE t1 ( a int not null, b int not null, KEY ab(a,b) );
INSERT INTO t1 VALUES ( 47,    1  );
INSERT INTO t1 VALUES ( 70,    1  );
SELECT * FROM t1 WHERE ( ( b =1 AND a BETWEEN 14 AND 21 ) OR ( b =2 AND a BETWEEN 16 AND 18 ) OR ( b =3 AND a BETWEEN 15 AND 19 ) );
DROP TABLE t1;
CREATE TABLE t1 ( a integer, u varchar(15), r integer, key uao_idx( r, a, u));
DELETE  FROM t1 WHERE (  r = 1 AND a IN ( 1, 2    ) AND ( u = 'w'   OR u LIKE 'w/%'   ) ) OR (  r = 1 AND a IN (       3 ) AND ( u = 'w/U' OR u LIKE 'w/U/%' ) ) OR (  r = 1 AND a IN ( 1, 2, 3 ) AND ( u = 'w'                     ) );
drop table t1;
CREATE TABLE t1 (a VARCHAR(16), UNIQUE(a));
INSERT INTO t1 VALUES ('1'), ('2'), ('3');
SELECT SQL_CALC_FOUND_ROWS * FROM t1 WHERE a = '2' LIMIT 0, 1;
SELECT FOUND_ROWS();
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (0), (0), (1), (2);
SELECT SQL_CALC_FOUND_ROWS * FROM t1 WHERE a = 0 GROUP BY a HAVING a > 10;
SELECT FOUND_ROWS();
DROP TABLE t1;
SELECT 'foo';
SELECT FOUND_ROWS();
SELECT SQL_CALC_FOUND_ROWS 'foo';
SELECT FOUND_ROWS();
SELECT SQL_CALC_FOUND_ROWS 'foo' limit 0;
SELECT FOUND_ROWS();
SELECT FOUND_ROWS();
SELECT SQL_CALC_FOUND_ROWS 'foo' UNION SELECT 'bar' LIMIT 0;
SELECT FOUND_ROWS();
CREATE TABLE t1 (a int, b int);
INSERT INTO t1 VALUES (1,2), (1,3), (1,4), (1,5);
SELECT SQL_CALC_FOUND_ROWS DISTINCT 'a' FROM t1 GROUP BY b LIMIT 2;
SELECT FOUND_ROWS();
DROP TABLE t1;
CREATE TABLE t1 (i INT);
INSERT INTO t1 VALUES (1), (2), (3), (4), (5);
(SELECT SQL_CALC_FOUND_ROWS * FROM t1 LIMIT 2 OFFSET 2) UNION ALL (SELECT 1 FROM t1 WHERE FALSE);
SELECT FOUND_ROWS();
DROP TABLE t1;
CREATE TABLE t1 (c1 int) ;
INSERT INTO t1 VALUES (1), (2), (3), (4);
(SELECT SQL_CALC_FOUND_ROWS * FROM t1 WHERE false LIMIT 8, 1) UNION ALL (SELECT * FROM t1 LIMIT 4, 4);
SELECT FOUND_ROWS();
DROP TABLE t1;
